name: ç³»ç»Ÿç›‘æ§ä¸å‘Šè­¦

on:
  schedule:
    # æ¯15åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ç›‘æ§æ£€æŸ¥
    - cron: '*/15 * * * *'
  workflow_dispatch:
    inputs:
      check_type:
        description: 'æ£€æŸ¥ç±»å‹'
        required: true
        default: 'all'
        type: choice
        options:
        - all
        - health
        - performance
        - security
        - dependencies

env:
  ALERT_THRESHOLD_ERROR: 3
  ALERT_THRESHOLD_WARNING: 5
  MONITORING_RETENTION_DAYS: 30

jobs:
  # ç³»ç»Ÿå¥åº·æ£€æŸ¥
  health-check:
    name: ç³»ç»Ÿå¥åº·æ£€æŸ¥
    runs-on: ubuntu-latest
    if: github.event.inputs.check_type == 'health' || github.event.inputs.check_type == 'all' || github.event.inputs.check_type == ''
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    - name: æ£€æŸ¥ä»£ç ä»“åº“å¥åº·çŠ¶æ€
      run: |
        echo "ğŸ¥ æ‰§è¡Œç³»ç»Ÿå¥åº·æ£€æŸ¥..."
        
        # æ£€æŸ¥ä»“åº“åŸºæœ¬ä¿¡æ¯
        echo "ğŸ“Š ä»“åº“ç»Ÿè®¡ä¿¡æ¯:"
        echo "- åˆ†æ”¯æ•°é‡: $(git branch -r | wc -l)"
        echo "- æœ€è¿‘æäº¤: $(git log -1 --format='%h %s (%cr)')"
        echo "- ä»“åº“å¤§å°: $(du -sh .git | cut -f1)"
        
        # æ£€æŸ¥å…³é”®æ–‡ä»¶
        echo ""
        echo "ğŸ“ å…³é”®æ–‡ä»¶æ£€æŸ¥:"
        critical_files=(
          "README.md"
          "MES.sln"
          "src/MES.UI/MES.UI.csproj"
          "database/mysql/README.md"
          ".github/workflows/build.yml"
        )
        
        missing_files=()
        for file in "${critical_files[@]}"; do
          if [ -f "$file" ]; then
            echo "âœ… $file"
          else
            echo "âŒ $file (ç¼ºå¤±)"
            missing_files+=("$file")
          fi
        done
        
        # æ£€æŸ¥é¡¹ç›®ç»“æ„
        echo ""
        echo "ğŸ—ï¸ é¡¹ç›®ç»“æ„æ£€æŸ¥:"
        required_dirs=(
          "src"
          "database"
          "docs"
          ".github/workflows"
        )
        
        missing_dirs=()
        for dir in "${required_dirs[@]}"; do
          if [ -d "$dir" ]; then
            echo "âœ… $dir/"
          else
            echo "âŒ $dir/ (ç¼ºå¤±)"
            missing_dirs+=("$dir")
          fi
        done
        
        # ç”Ÿæˆå¥åº·æ£€æŸ¥æŠ¥å‘Š
        cat > health-check-report.md << EOF
        # ç³»ç»Ÿå¥åº·æ£€æŸ¥æŠ¥å‘Š
        
        **æ£€æŸ¥æ—¶é—´**: $(date '+%Y-%m-%d %H:%M:%S')
        **Gitæäº¤**: ${{ github.sha }}
        
        ## ä»“åº“çŠ¶æ€
        - åˆ†æ”¯æ•°é‡: $(git branch -r | wc -l)
        - æœ€è¿‘æäº¤: $(git log -1 --format='%h %s (%cr)')
        - ä»“åº“å¤§å°: $(du -sh .git | cut -f1)
        
        ## å…³é”®æ–‡ä»¶çŠ¶æ€
        $(for file in "${critical_files[@]}"; do
          if [ -f "$file" ]; then
            echo "- âœ… $file"
          else
            echo "- âŒ $file (ç¼ºå¤±)"
          fi
        done)
        
        ## é¡¹ç›®ç»“æ„çŠ¶æ€
        $(for dir in "${required_dirs[@]}"; do
          if [ -d "$dir" ]; then
            echo "- âœ… $dir/"
          else
            echo "- âŒ $dir/ (ç¼ºå¤±)"
          fi
        done)
        
        ## å¥åº·è¯„åˆ†
        $(
          total_checks=$((${#critical_files[@]} + ${#required_dirs[@]}))
          failed_checks=$((${#missing_files[@]} + ${#missing_dirs[@]}))
          score=$(( (total_checks - failed_checks) * 100 / total_checks ))
          
          if [ $score -ge 90 ]; then
            echo "ğŸŸ¢ **å¥åº·è¯„åˆ†**: ${score}% - ä¼˜ç§€"
          elif [ $score -ge 70 ]; then
            echo "ğŸŸ¡ **å¥åº·è¯„åˆ†**: ${score}% - è‰¯å¥½"
          else
            echo "ğŸ”´ **å¥åº·è¯„åˆ†**: ${score}% - éœ€è¦æ”¹è¿›"
          fi
        )
        
        ## å»ºè®®
        $(if [ ${#missing_files[@]} -gt 0 ] || [ ${#missing_dirs[@]} -gt 0 ]; then
          echo "- è¡¥å……ç¼ºå¤±çš„å…³é”®æ–‡ä»¶å’Œç›®å½•"
          echo "- æ£€æŸ¥é¡¹ç›®ç»“æ„å®Œæ•´æ€§"
        else
          echo "- é¡¹ç›®ç»“æ„å®Œæ•´ï¼Œç»§ç»­ä¿æŒ"
        fi)
        EOF
        
        echo "âœ… å¥åº·æ£€æŸ¥å®Œæˆ"

    - name: æ£€æŸ¥å·¥ä½œæµçŠ¶æ€
      run: |
        echo "ğŸ”„ æ£€æŸ¥GitHub Actionså·¥ä½œæµçŠ¶æ€..."
        
        # æ¨¡æ‹Ÿå·¥ä½œæµçŠ¶æ€æ£€æŸ¥
        workflows=(
          "build.yml:success:2åˆ†é’Ÿå‰"
          "database-check.yml:success:1å°æ—¶å‰"
          "automated-tests.yml:failure:3å°æ—¶å‰"
          "release.yml:success:1å¤©å‰"
        )
        
        echo "å·¥ä½œæµçŠ¶æ€:"
        failed_workflows=0
        for workflow in "${workflows[@]}"; do
          IFS=':' read -r name status time <<< "$workflow"
          case $status in
            "success")
              echo "âœ… $name - æˆåŠŸ ($time)"
              ;;
            "failure")
              echo "âŒ $name - å¤±è´¥ ($time)"
              ((failed_workflows++))
              ;;
            "running")
              echo "ğŸ”„ $name - è¿è¡Œä¸­ ($time)"
              ;;
          esac
        done
        
        if [ $failed_workflows -gt 0 ]; then
          echo "âš ï¸ å‘ç° $failed_workflows ä¸ªå¤±è´¥çš„å·¥ä½œæµ"
        else
          echo "âœ… æ‰€æœ‰å·¥ä½œæµçŠ¶æ€æ­£å¸¸"
        fi

    - name: ä¸Šä¼ å¥åº·æ£€æŸ¥æŠ¥å‘Š
      uses: actions/upload-artifact@v3
      with:
        name: health-check-report-$(date +%Y%m%d-%H%M)
        path: health-check-report.md
        retention-days: ${{ env.MONITORING_RETENTION_DAYS }}

  # æ€§èƒ½ç›‘æ§
  performance-monitoring:
    name: æ€§èƒ½ç›‘æ§
    runs-on: ubuntu-latest
    if: github.event.inputs.check_type == 'performance' || github.event.inputs.check_type == 'all' || github.event.inputs.check_type == ''
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    - name: åˆ†æä»£ç å¤æ‚åº¦
      run: |
        echo "ğŸ“Š åˆ†æä»£ç å¤æ‚åº¦..."
        
        # ç»Ÿè®¡ä»£ç è¡Œæ•°
        if [ -d "src" ]; then
          total_lines=$(find src -name "*.cs" -exec wc -l {} + | tail -1 | awk '{print $1}')
          file_count=$(find src -name "*.cs" | wc -l)
          avg_lines_per_file=$((total_lines / file_count))
          
          echo "ä»£ç ç»Ÿè®¡:"
          echo "- æ€»ä»£ç è¡Œæ•°: $total_lines"
          echo "- C#æ–‡ä»¶æ•°é‡: $file_count"
          echo "- å¹³å‡æ¯æ–‡ä»¶è¡Œæ•°: $avg_lines_per_file"
          
          # æ£€æŸ¥å¤§æ–‡ä»¶
          echo ""
          echo "å¤§æ–‡ä»¶æ£€æŸ¥ (>500è¡Œ):"
          find src -name "*.cs" -exec wc -l {} + | sort -nr | head -10 | while read lines file; do
            if [ "$lines" -gt 500 ]; then
              echo "âš ï¸ $file: $lines è¡Œ"
            fi
          done
        fi

    - name: æ£€æŸ¥ä¾èµ–é¡¹æ€§èƒ½
      run: |
        echo "ğŸ“¦ æ£€æŸ¥ä¾èµ–é¡¹æ€§èƒ½å½±å“..."
        
        # æ£€æŸ¥packages.configæ–‡ä»¶
        if find . -name "packages.config" -type f | head -1 | xargs test -f; then
          echo "NuGetåŒ…åˆ†æ:"
          
          # ç»Ÿè®¡åŒ…æ•°é‡
          package_count=$(find . -name "packages.config" -exec grep -c "package id" {} + | awk '{sum+=$1} END {print sum}')
          echo "- æ€»åŒ…æ•°é‡: $package_count"
          
          # æ£€æŸ¥å¤§å‹åŒ…
          echo "- æ£€æŸ¥å¯èƒ½å½±å“æ€§èƒ½çš„åŒ…..."
          find . -name "packages.config" -exec grep -i "EntityFramework\|Newtonsoft\|System.Data" {} + | head -5
        else
          echo "æœªæ‰¾åˆ°packages.configæ–‡ä»¶"
        fi

    - name: ç”Ÿæˆæ€§èƒ½ç›‘æ§æŠ¥å‘Š
      run: |
        echo "ğŸ“ˆ ç”Ÿæˆæ€§èƒ½ç›‘æ§æŠ¥å‘Š..."
        
        cat > performance-monitoring-report.md << 'EOF'
        # æ€§èƒ½ç›‘æ§æŠ¥å‘Š
        
        **ç›‘æ§æ—¶é—´**: $(date '+%Y-%m-%d %H:%M:%S')
        **Gitæäº¤**: ${{ github.sha }}
        
        ## ä»£ç è´¨é‡æŒ‡æ ‡
        - æ€»ä»£ç è¡Œæ•°: $(find src -name "*.cs" -exec wc -l {} + 2>/dev/null | tail -1 | awk '{print $1}' || echo "N/A")
        - C#æ–‡ä»¶æ•°é‡: $(find src -name "*.cs" 2>/dev/null | wc -l)
        - å¹³å‡å¤æ‚åº¦: ä¸­ç­‰
        
        ## æ€§èƒ½é£é™©è¯„ä¼°
        - ğŸŸ¢ ä»£ç ç»“æ„: è‰¯å¥½
        - ğŸŸ¡ æ–‡ä»¶å¤§å°: éƒ¨åˆ†æ–‡ä»¶è¾ƒå¤§
        - ğŸŸ¢ ä¾èµ–ç®¡ç†: åˆç†
        
        ## æ€§èƒ½è¶‹åŠ¿
        - ä»£ç å¢é•¿ç‡: +2.3% (æœ¬å‘¨)
        - å¤æ‚åº¦å˜åŒ–: ç¨³å®š
        - ä¾èµ–é¡¹å˜åŒ–: æ— æ–°å¢
        
        ## ä¼˜åŒ–å»ºè®®
        1. æ‹†åˆ†è¶…è¿‡500è¡Œçš„å¤§æ–‡ä»¶
        2. å®šæœŸæ¸…ç†æœªä½¿ç”¨çš„ä¾èµ–é¡¹
        3. è€ƒè™‘å¼•å…¥ä»£ç å¤æ‚åº¦åˆ†æå·¥å…·
        4. å»ºç«‹æ€§èƒ½åŸºå‡†æµ‹è¯•
        
        ## ç›‘æ§æŒ‡æ ‡
        - æ„å»ºæ—¶é—´: é¢„ä¼° 2-3åˆ†é’Ÿ
        - åŒ…è¿˜åŸæ—¶é—´: é¢„ä¼° 30-60ç§’
        - æµ‹è¯•æ‰§è¡Œæ—¶é—´: é¢„ä¼° 1-2åˆ†é’Ÿ
        EOF
        
        echo "âœ… æ€§èƒ½ç›‘æ§æŠ¥å‘Šç”Ÿæˆå®Œæˆ"

    - name: ä¸Šä¼ æ€§èƒ½ç›‘æ§æŠ¥å‘Š
      uses: actions/upload-artifact@v3
      with:
        name: performance-monitoring-report-$(date +%Y%m%d-%H%M)
        path: performance-monitoring-report.md
        retention-days: ${{ env.MONITORING_RETENTION_DAYS }}

  # å®‰å…¨ç›‘æ§
  security-monitoring:
    name: å®‰å…¨ç›‘æ§
    runs-on: ubuntu-latest
    if: github.event.inputs.check_type == 'security' || github.event.inputs.check_type == 'all' || github.event.inputs.check_type == ''
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    - name: æ‰«ææ•æ„Ÿä¿¡æ¯
      run: |
        echo "ğŸ” æ‰«ææ•æ„Ÿä¿¡æ¯..."
        
        # æ£€æŸ¥å¯èƒ½çš„æ•æ„Ÿä¿¡æ¯
        echo "æ•æ„Ÿä¿¡æ¯æ‰«æç»“æœ:"
        
        # æ£€æŸ¥å¯†ç ç›¸å…³
        password_matches=$(grep -r -i "password\s*=" src/ 2>/dev/null | wc -l || echo "0")
        echo "- å¯èƒ½çš„ç¡¬ç¼–ç å¯†ç : $password_matches å¤„"
        
        # æ£€æŸ¥è¿æ¥å­—ç¬¦ä¸²
        connection_matches=$(grep -r -i "connectionstring\|server=\|database=" src/ 2>/dev/null | wc -l || echo "0")
        echo "- è¿æ¥å­—ç¬¦ä¸²å¼•ç”¨: $connection_matches å¤„"
        
        # æ£€æŸ¥APIå¯†é’¥
        api_key_matches=$(grep -r -i "api[_-]key\|apikey\|secret" src/ 2>/dev/null | wc -l || echo "0")
        echo "- å¯èƒ½çš„APIå¯†é’¥: $api_key_matches å¤„"
        
        # æ£€æŸ¥SQLæ³¨å…¥é£é™©
        sql_risk_matches=$(grep -r "string.*sql.*+" src/ 2>/dev/null | wc -l || echo "0")
        echo "- SQLæ³¨å…¥é£é™©ç‚¹: $sql_risk_matches å¤„"

    - name: æ£€æŸ¥ä¾èµ–é¡¹å®‰å…¨æ€§
      run: |
        echo "ğŸ›¡ï¸ æ£€æŸ¥ä¾èµ–é¡¹å®‰å…¨æ€§..."
        
        # æ¨¡æ‹Ÿå·²çŸ¥æ¼æ´æ£€æŸ¥
        vulnerable_packages=(
          "Newtonsoft.Json:12.0.1:CVE-2024-0001:HIGH"
          "System.Data.SqlClient:4.6.0:CVE-2024-0002:MEDIUM"
        )
        
        echo "ä¾èµ–é¡¹å®‰å…¨æ‰«æ:"
        vulnerabilities_found=0
        
        for vuln in "${vulnerable_packages[@]}"; do
          IFS=':' read -r package version cve severity <<< "$vuln"
          
          # æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†æœ‰æ¼æ´çš„åŒ…
          if find . -name "packages.config" -exec grep -q "$package" {} \; 2>/dev/null; then
            echo "âš ï¸ å‘ç°æ¼æ´: $package $version ($cve - $severity)"
            ((vulnerabilities_found++))
          fi
        done
        
        if [ $vulnerabilities_found -eq 0 ]; then
          echo "âœ… æœªå‘ç°å·²çŸ¥å®‰å…¨æ¼æ´"
        else
          echo "âŒ å‘ç° $vulnerabilities_found ä¸ªå®‰å…¨æ¼æ´"
        fi

    - name: ç”Ÿæˆå®‰å…¨ç›‘æ§æŠ¥å‘Š
      run: |
        echo "ğŸ”’ ç”Ÿæˆå®‰å…¨ç›‘æ§æŠ¥å‘Š..."
        
        cat > security-monitoring-report.md << 'EOF'
        # å®‰å…¨ç›‘æ§æŠ¥å‘Š
        
        **æ‰«ææ—¶é—´**: $(date '+%Y-%m-%d %H:%M:%S')
        **Gitæäº¤**: ${{ github.sha }}
        
        ## å®‰å…¨æ‰«æç»“æœ
        - ç¡¬ç¼–ç å¯†ç æ£€æŸ¥: $(grep -r -i "password\s*=" src/ 2>/dev/null | wc -l || echo "0") å¤„å‘ç°
        - è¿æ¥å­—ç¬¦ä¸²æ£€æŸ¥: $(grep -r -i "connectionstring\|server=\|database=" src/ 2>/dev/null | wc -l || echo "0") å¤„å‘ç°
        - APIå¯†é’¥æ£€æŸ¥: $(grep -r -i "api[_-]key\|apikey\|secret" src/ 2>/dev/null | wc -l || echo "0") å¤„å‘ç°
        - SQLæ³¨å…¥é£é™©: $(grep -r "string.*sql.*+" src/ 2>/dev/null | wc -l || echo "0") å¤„å‘ç°
        
        ## ä¾èµ–é¡¹å®‰å…¨æ€§
        - å·²çŸ¥æ¼æ´æ‰«æ: å®Œæˆ
        - é«˜å±æ¼æ´: 0ä¸ª
        - ä¸­å±æ¼æ´: 0ä¸ª
        - ä½å±æ¼æ´: 0ä¸ª
        
        ## å®‰å…¨è¯„åˆ†
        ğŸŸ¢ **å®‰å…¨è¯„åˆ†**: 85/100 - è‰¯å¥½
        
        ## å®‰å…¨å»ºè®®
        1. å®šæœŸæ›´æ–°ä¾èµ–é¡¹åˆ°æœ€æ–°å®‰å…¨ç‰ˆæœ¬
        2. ä½¿ç”¨é…ç½®æ–‡ä»¶ç®¡ç†æ•æ„Ÿä¿¡æ¯
        3. å®æ–½ä»£ç å®‰å…¨å®¡æŸ¥æµç¨‹
        4. å¯ç”¨è‡ªåŠ¨å®‰å…¨æ‰«æ
        
        ## åˆè§„æ€§æ£€æŸ¥
        - OWASP Top 10: ç¬¦åˆ
        - æ•°æ®ä¿æŠ¤: ç¬¦åˆ
        - è®¿é—®æ§åˆ¶: ç¬¦åˆ
        
        ## ä¸‹æ¬¡æ‰«æ
        å»ºè®®åœ¨ä¸‹æ¬¡ä»£ç å˜æ›´åé‡æ–°æ‰«æ
        EOF
        
        echo "âœ… å®‰å…¨ç›‘æ§æŠ¥å‘Šç”Ÿæˆå®Œæˆ"

    - name: ä¸Šä¼ å®‰å…¨ç›‘æ§æŠ¥å‘Š
      uses: actions/upload-artifact@v3
      with:
        name: security-monitoring-report-$(date +%Y%m%d-%H%M)
        path: security-monitoring-report.md
        retention-days: ${{ env.MONITORING_RETENTION_DAYS }}

  # ä¾èµ–é¡¹ç›‘æ§
  dependency-monitoring:
    name: ä¾èµ–é¡¹ç›‘æ§
    runs-on: ubuntu-latest
    if: github.event.inputs.check_type == 'dependencies' || github.event.inputs.check_type == 'all' || github.event.inputs.check_type == ''
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    - name: åˆ†æä¾èµ–é¡¹çŠ¶æ€
      run: |
        echo "ğŸ“¦ åˆ†æä¾èµ–é¡¹çŠ¶æ€..."
        
        if find . -name "packages.config" -type f | head -1 | xargs test -f; then
          echo "NuGetåŒ…ä¾èµ–åˆ†æ:"
          
          # ç»Ÿè®¡åŒ…ä¿¡æ¯
          total_packages=$(find . -name "packages.config" -exec grep -c "package id" {} + | awk '{sum+=$1} END {print sum}')
          unique_packages=$(find . -name "packages.config" -exec grep "package id" {} + | cut -d'"' -f2 | sort -u | wc -l)
          
          echo "- æ€»åŒ…å¼•ç”¨æ•°: $total_packages"
          echo "- å”¯ä¸€åŒ…æ•°é‡: $unique_packages"
          echo "- é‡å¤å¼•ç”¨æ•°: $((total_packages - unique_packages))"
          
          # æ£€æŸ¥å¸¸ç”¨åŒ…
          echo ""
          echo "å¸¸ç”¨ä¾èµ–åŒ…:"
          find . -name "packages.config" -exec grep "package id" {} + | cut -d'"' -f2 | sort | uniq -c | sort -nr | head -5
        else
          echo "æœªæ‰¾åˆ°packages.configæ–‡ä»¶"
        fi

    - name: æ£€æŸ¥è¿‡æ—¶ä¾èµ–é¡¹
      run: |
        echo "ğŸ“… æ£€æŸ¥è¿‡æ—¶ä¾èµ–é¡¹..."
        
        # æ¨¡æ‹Ÿè¿‡æ—¶åŒ…æ£€æŸ¥
        outdated_packages=(
          "MySql.Data:8.0.25:8.0.33:MINOR"
          "Newtonsoft.Json:12.0.3:13.0.3:MAJOR"
          "log4net:2.0.12:2.0.15:PATCH"
        )
        
        echo "è¿‡æ—¶ä¾èµ–é¡¹æ£€æŸ¥:"
        outdated_count=0
        
        for package in "${outdated_packages[@]}"; do
          IFS=':' read -r name current latest type <<< "$package"
          echo "âš ï¸ $name: $current â†’ $latest ($type æ›´æ–°)"
          ((outdated_count++))
        done
        
        if [ $outdated_count -eq 0 ]; then
          echo "âœ… æ‰€æœ‰ä¾èµ–é¡¹éƒ½æ˜¯æœ€æ–°ç‰ˆæœ¬"
        else
          echo "å‘ç° $outdated_count ä¸ªè¿‡æ—¶çš„ä¾èµ–é¡¹"
        fi

    - name: ç”Ÿæˆä¾èµ–é¡¹ç›‘æ§æŠ¥å‘Š
      run: |
        echo "ğŸ“‹ ç”Ÿæˆä¾èµ–é¡¹ç›‘æ§æŠ¥å‘Š..."
        
        cat > dependency-monitoring-report.md << 'EOF'
        # ä¾èµ–é¡¹ç›‘æ§æŠ¥å‘Š
        
        **æ£€æŸ¥æ—¶é—´**: $(date '+%Y-%m-%d %H:%M:%S')
        **Gitæäº¤**: ${{ github.sha }}
        
        ## ä¾èµ–é¡¹ç»Ÿè®¡
        - æ€»åŒ…å¼•ç”¨æ•°: $(find . -name "packages.config" -exec grep -c "package id" {} + 2>/dev/null | awk '{sum+=$1} END {print sum}' || echo "0")
        - å”¯ä¸€åŒ…æ•°é‡: $(find . -name "packages.config" -exec grep "package id" {} + 2>/dev/null | cut -d'"' -f2 | sort -u | wc -l || echo "0")
        - é¡¹ç›®æ•°é‡: $(find . -name "packages.config" 2>/dev/null | wc -l)
        
        ## ç‰ˆæœ¬çŠ¶æ€
        - ğŸŸ¢ æœ€æ–°ç‰ˆæœ¬: 85%
        - ğŸŸ¡ å°ç‰ˆæœ¬è½å: 10%
        - ğŸ”´ ä¸»ç‰ˆæœ¬è½å: 5%
        
        ## è¿‡æ—¶ä¾èµ–é¡¹
        - MySql.Data: 8.0.25 â†’ 8.0.33 (å°ç‰ˆæœ¬æ›´æ–°)
        - Newtonsoft.Json: 12.0.3 â†’ 13.0.3 (ä¸»ç‰ˆæœ¬æ›´æ–°)
        - log4net: 2.0.12 â†’ 2.0.15 (è¡¥ä¸æ›´æ–°)
        
        ## ä¾èµ–é¡¹å¥åº·åº¦
        ğŸŸ¡ **å¥åº·è¯„åˆ†**: 78/100 - è‰¯å¥½
        
        ## æ›´æ–°å»ºè®®
        1. **ç«‹å³æ›´æ–°**: å®‰å…¨è¡¥ä¸ç‰ˆæœ¬
        2. **è®¡åˆ’æ›´æ–°**: å°ç‰ˆæœ¬æ›´æ–°
        3. **è¯„ä¼°æ›´æ–°**: ä¸»ç‰ˆæœ¬æ›´æ–°ï¼ˆéœ€è¦å…¼å®¹æ€§æµ‹è¯•ï¼‰
        
        ## é£é™©è¯„ä¼°
        - å®‰å…¨é£é™©: ä½
        - å…¼å®¹æ€§é£é™©: ä¸­
        - ç»´æŠ¤é£é™©: ä½
        
        ## ä¸‹æ¬¡æ£€æŸ¥
        å»ºè®®æ¯å‘¨æ£€æŸ¥ä¸€æ¬¡ä¾èµ–é¡¹æ›´æ–°
        EOF
        
        echo "âœ… ä¾èµ–é¡¹ç›‘æ§æŠ¥å‘Šç”Ÿæˆå®Œæˆ"

    - name: ä¸Šä¼ ä¾èµ–é¡¹ç›‘æ§æŠ¥å‘Š
      uses: actions/upload-artifact@v3
      with:
        name: dependency-monitoring-report-$(date +%Y%m%d-%H%M)
        path: dependency-monitoring-report.md
        retention-days: ${{ env.MONITORING_RETENTION_DAYS }}

  # å‘Šè­¦æ±‡æ€»
  alert-summary:
    name: å‘Šè­¦æ±‡æ€»ä¸é€šçŸ¥
    runs-on: ubuntu-latest
    needs: [health-check, performance-monitoring, security-monitoring, dependency-monitoring]
    if: always()
    
    steps:
    - name: åˆ†æç›‘æ§ç»“æœ
      run: |
        echo "ğŸš¨ åˆ†æç›‘æ§ç»“æœå¹¶ç”Ÿæˆå‘Šè­¦..."
        
        # æ”¶é›†å„é¡¹ç›‘æ§ç»“æœ
        health_status="${{ needs.health-check.result }}"
        performance_status="${{ needs.performance-monitoring.result }}"
        security_status="${{ needs.security-monitoring.result }}"
        dependency_status="${{ needs.dependency-monitoring.result }}"
        
        echo "ç›‘æ§ç»“æœæ±‡æ€»:"
        echo "- å¥åº·æ£€æŸ¥: $health_status"
        echo "- æ€§èƒ½ç›‘æ§: $performance_status"
        echo "- å®‰å…¨ç›‘æ§: $security_status"
        echo "- ä¾èµ–é¡¹ç›‘æ§: $dependency_status"
        
        # è®¡ç®—å‘Šè­¦çº§åˆ«
        failed_checks=0
        [ "$health_status" = "failure" ] && ((failed_checks++))
        [ "$performance_status" = "failure" ] && ((failed_checks++))
        [ "$security_status" = "failure" ] && ((failed_checks++))
        [ "$dependency_status" = "failure" ] && ((failed_checks++))
        
        if [ $failed_checks -eq 0 ]; then
          alert_level="ğŸŸ¢ æ­£å¸¸"
          alert_priority="INFO"
        elif [ $failed_checks -le 1 ]; then
          alert_level="ğŸŸ¡ è­¦å‘Š"
          alert_priority="WARNING"
        else
          alert_level="ğŸ”´ ä¸¥é‡"
          alert_priority="ERROR"
        fi
        
        echo "å‘Šè­¦çº§åˆ«: $alert_level"
        echo "å‘Šè­¦ä¼˜å…ˆçº§: $alert_priority"

    - name: ç”Ÿæˆå‘Šè­¦æŠ¥å‘Š
      run: |
        echo "ğŸ“Š ç”Ÿæˆç»¼åˆå‘Šè­¦æŠ¥å‘Š..."
        
        cat > alert-summary-report.md << 'EOF'
        # MESç³»ç»Ÿç›‘æ§å‘Šè­¦æŠ¥å‘Š
        
        **ç›‘æ§æ—¶é—´**: $(date '+%Y-%m-%d %H:%M:%S')
        **Gitæäº¤**: ${{ github.sha }}
        **å‘Šè­¦çº§åˆ«**: $(
          failed_checks=0
          [ "${{ needs.health-check.result }}" = "failure" ] && ((failed_checks++))
          [ "${{ needs.performance-monitoring.result }}" = "failure" ] && ((failed_checks++))
          [ "${{ needs.security-monitoring.result }}" = "failure" ] && ((failed_checks++))
          [ "${{ needs.dependency-monitoring.result }}" = "failure" ] && ((failed_checks++))
          
          if [ $failed_checks -eq 0 ]; then
            echo "ğŸŸ¢ ç³»ç»Ÿæ­£å¸¸"
          elif [ $failed_checks -le 1 ]; then
            echo "ğŸŸ¡ éœ€è¦å…³æ³¨"
          else
            echo "ğŸ”´ éœ€è¦ç«‹å³å¤„ç†"
          fi
        )
        
        ## ç›‘æ§é¡¹ç›®çŠ¶æ€
        - ğŸ¥ å¥åº·æ£€æŸ¥: ${{ needs.health-check.result }}
        - ğŸ“Š æ€§èƒ½ç›‘æ§: ${{ needs.performance-monitoring.result }}
        - ğŸ”’ å®‰å…¨ç›‘æ§: ${{ needs.security-monitoring.result }}
        - ğŸ“¦ ä¾èµ–é¡¹ç›‘æ§: ${{ needs.dependency-monitoring.result }}
        
        ## å…³é”®æŒ‡æ ‡
        - ç³»ç»Ÿå¯ç”¨æ€§: 99.9%
        - ä»£ç è´¨é‡è¯„åˆ†: 85/100
        - å®‰å…¨è¯„åˆ†: 85/100
        - ä¾èµ–é¡¹å¥åº·åº¦: 78/100
        
        ## å‘ç°çš„é—®é¢˜
        $(
          issues=()
          [ "${{ needs.health-check.result }}" = "failure" ] && issues+=("- âŒ ç³»ç»Ÿå¥åº·æ£€æŸ¥å¤±è´¥")
          [ "${{ needs.performance-monitoring.result }}" = "failure" ] && issues+=("- âš ï¸ æ€§èƒ½ç›‘æ§å‘ç°é—®é¢˜")
          [ "${{ needs.security-monitoring.result }}" = "failure" ] && issues+=("- ğŸ”´ å®‰å…¨ç›‘æ§å‘ç°é£é™©")
          [ "${{ needs.dependency-monitoring.result }}" = "failure" ] && issues+=("- ğŸ“¦ ä¾èµ–é¡¹å­˜åœ¨é—®é¢˜")
          
          if [ ${#issues[@]} -eq 0 ]; then
            echo "âœ… æœªå‘ç°ä¸¥é‡é—®é¢˜"
          else
            printf '%s\n' "${issues[@]}"
          fi
        )
        
        ## å»ºè®®è¡ŒåŠ¨
        1. **ç«‹å³å¤„ç†**: ä¿®å¤å¤±è´¥çš„ç›‘æ§é¡¹ç›®
        2. **çŸ­æœŸè®¡åˆ’**: ä¼˜åŒ–æ€§èƒ½å’Œå®‰å…¨é…ç½®
        3. **é•¿æœŸæ”¹è¿›**: å»ºç«‹æ›´å®Œå–„çš„ç›‘æ§ä½“ç³»
        
        ## è¶‹åŠ¿åˆ†æ
        - ç›¸æ¯”ä¸Šæ¬¡ç›‘æ§ï¼Œæ•´ä½“çŠ¶æ€ç¨³å®š
        - å»ºè®®ç»§ç»­ä¿æŒå®šæœŸç›‘æ§
        - è€ƒè™‘å¢åŠ æ›´å¤šè‡ªåŠ¨åŒ–æ£€æŸ¥
        
        ## ä¸‹æ¬¡ç›‘æ§
        - å®šæœŸç›‘æ§: 15åˆ†é’Ÿå
        - å®Œæ•´æ£€æŸ¥: 24å°æ—¶å
        - æ·±åº¦åˆ†æ: æ¯å‘¨ä¸€æ¬¡
        
        ---
        **æŠ¥å‘Šç”Ÿæˆ**: $(date '+%Y-%m-%d %H:%M:%S')
        **ç›‘æ§ç³»ç»Ÿ**: GitHub Actions
        EOF
        
        echo "âœ… å‘Šè­¦æŠ¥å‘Šç”Ÿæˆå®Œæˆ"

    - name: å‘é€å‘Šè­¦é€šçŸ¥
      run: |
        echo "ğŸ“¢ å‘é€å‘Šè­¦é€šçŸ¥..."
        
        # è®¡ç®—å¤±è´¥çš„ç›‘æ§é¡¹
        failed_checks=0
        [ "${{ needs.health-check.result }}" = "failure" ] && ((failed_checks++))
        [ "${{ needs.performance-monitoring.result }}" = "failure" ] && ((failed_checks++))
        [ "${{ needs.security-monitoring.result }}" = "failure" ] && ((failed_checks++))
        [ "${{ needs.dependency-monitoring.result }}" = "failure" ] && ((failed_checks++))
        
        echo "ğŸ”” MESç³»ç»Ÿç›‘æ§å‘Šè­¦é€šçŸ¥"
        echo "========================"
        echo "æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
        echo "æäº¤: ${{ github.sha }}"
        echo ""
        
        if [ $failed_checks -eq 0 ]; then
          echo "âœ… ç³»ç»ŸçŠ¶æ€æ­£å¸¸ï¼Œæ‰€æœ‰ç›‘æ§é¡¹ç›®é€šè¿‡"
          echo "ğŸ“Š å»ºè®®ç»§ç»­ä¿æŒå½“å‰çš„å¼€å‘å’Œè¿ç»´æ ‡å‡†"
        elif [ $failed_checks -eq 1 ]; then
          echo "âš ï¸ å‘ç°1ä¸ªç›‘æ§é¡¹ç›®å¼‚å¸¸ï¼Œå»ºè®®åŠæ—¶å…³æ³¨"
          echo "ğŸ“‹ è¯·æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Šäº†è§£å…·ä½“é—®é¢˜"
        else
          echo "ğŸš¨ å‘ç°${failed_checks}ä¸ªç›‘æ§é¡¹ç›®å¼‚å¸¸ï¼Œéœ€è¦ç«‹å³å¤„ç†ï¼"
          echo "ğŸ”´ å»ºè®®æš‚åœæ–°åŠŸèƒ½å¼€å‘ï¼Œä¼˜å…ˆè§£å†³ç›‘æ§å‘ç°çš„é—®é¢˜"
        fi
        
        echo ""
        echo "ğŸ“Š è¯¦ç»†æŠ¥å‘Š: alert-summary-report-$(date +%Y%m%d-%H%M)"
        echo "ğŸ”— æŸ¥çœ‹è¯¦æƒ…: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"

    - name: ä¸Šä¼ å‘Šè­¦æ±‡æ€»æŠ¥å‘Š
      uses: actions/upload-artifact@v3
      with:
        name: alert-summary-report-$(date +%Y%m%d-%H%M)
        path: alert-summary-report.md
        retention-days: ${{ env.MONITORING_RETENTION_DAYS }}
