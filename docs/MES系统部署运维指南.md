# MESåˆ¶é€ æ‰§è¡Œç³»ç»Ÿ - éƒ¨ç½²è¿ç»´æŒ‡å—

> **ç‰ˆæœ¬**: 1.0  
> **æ›´æ–°æ—¶é—´**: 2025-06-06  
> **ç»´æŠ¤è€…**: MESå¼€å‘å›¢é˜Ÿ

## ğŸ“‹ ç›®å½•

- [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
- [ç¯å¢ƒè¦æ±‚](#ç¯å¢ƒè¦æ±‚)
- [éƒ¨ç½²æµç¨‹](#éƒ¨ç½²æµç¨‹)
- [é…ç½®ç®¡ç†](#é…ç½®ç®¡ç†)
- [è¿ç»´ç›‘æ§](#è¿ç»´ç›‘æ§)
- [å¤‡ä»½æ¢å¤](#å¤‡ä»½æ¢å¤)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
- [å®‰å…¨ç®¡ç†](#å®‰å…¨ç®¡ç†)

## ğŸ¯ ç³»ç»Ÿæ¦‚è¿°

MESåˆ¶é€ æ‰§è¡Œç³»ç»Ÿæ˜¯åŸºäº.NET Framework 4.8 + WinForms + MySQL 8.0çš„ä¼ä¸šçº§åˆ¶é€ æ‰§è¡Œç³»ç»Ÿï¼Œé‡‡ç”¨ä¸‰å±‚æ¶æ„è®¾è®¡ï¼Œæ”¯æŒç‰©æ–™ç®¡ç†ã€ç”Ÿäº§ç®¡ç†ã€è½¦é—´ç®¡ç†ã€è®¾å¤‡ç®¡ç†ã€è´¨é‡ç®¡ç†ç­‰æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½ã€‚

### ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å®¢æˆ·ç«¯å±‚ (WinForms)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   ä¸»ç•Œé¢        â”‚ â”‚   ä¸šåŠ¡çª—ä½“      â”‚ â”‚   æŠ¥è¡¨ç•Œé¢      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ä¸šåŠ¡é€»è¾‘å±‚ (BLL)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   ç‰©æ–™ç®¡ç†      â”‚ â”‚   ç”Ÿäº§ç®¡ç†      â”‚ â”‚   è´¨é‡ç®¡ç†      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ•°æ®è®¿é—®å±‚ (DAL)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   MySQLè¿æ¥     â”‚ â”‚   æ•°æ®æ“ä½œ      â”‚ â”‚   äº‹åŠ¡ç®¡ç†      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     MySQL 8.0 æ•°æ®åº“                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ ç¯å¢ƒè¦æ±‚

### ç¡¬ä»¶è¦æ±‚

| ç»„ä»¶ | æœ€ä½é…ç½® | æ¨èé…ç½® |
|------|----------|----------|
| **CPU** | Intel i3 æˆ–åŒç­‰æ€§èƒ½ | Intel i5 æˆ–æ›´é«˜ |
| **å†…å­˜** | 4GB RAM | 8GB RAM æˆ–æ›´é«˜ |
| **ç¡¬ç›˜** | 100GB å¯ç”¨ç©ºé—´ | 500GB SSD |
| **ç½‘ç»œ** | 100Mbps | 1Gbps |

### è½¯ä»¶è¦æ±‚

| è½¯ä»¶ | ç‰ˆæœ¬è¦æ±‚ | è¯´æ˜ |
|------|----------|------|
| **æ“ä½œç³»ç»Ÿ** | Windows 10/11, Windows Server 2016+ | æ”¯æŒ.NET Framework 4.8 |
| **.NET Framework** | 4.8 | å¿…é¡»å®‰è£… |
| **MySQL** | 8.0+ | æ•°æ®åº“æœåŠ¡å™¨ |
| **Visual Studio** | 2019/2022 | å¼€å‘ç¯å¢ƒï¼ˆå¯é€‰ï¼‰ |
| **Git** | 2.30+ | ç‰ˆæœ¬æ§åˆ¶ |

### ç½‘ç»œè¦æ±‚

- **æ•°æ®åº“ç«¯å£**: 3306 (MySQL)
- **åº”ç”¨ç«¯å£**: æ ¹æ®éœ€è¦é…ç½®
- **é˜²ç«å¢™**: å…è®¸MySQLç«¯å£è®¿é—®

## ğŸš€ éƒ¨ç½²æµç¨‹

### 1. ç¯å¢ƒå‡†å¤‡

#### 1.1 å®‰è£….NET Framework 4.8
```powershell
# ä¸‹è½½å¹¶å®‰è£….NET Framework 4.8
# https://dotnet.microsoft.com/download/dotnet-framework/net48
```

#### 1.2 å®‰è£…MySQL 8.0
```bash
# Windowsç¯å¢ƒä¸‹è½½MySQLå®‰è£…åŒ…
# https://dev.mysql.com/downloads/mysql/

# é…ç½®MySQLæœåŠ¡
# è®¾ç½®rootå¯†ç 
# å¯ç”¨MySQLæœåŠ¡
```

#### 1.3 é…ç½®MySQL
```sql
-- åˆ›å»ºMESä¸“ç”¨ç”¨æˆ·
CREATE USER 'mes_user'@'localhost' IDENTIFIED BY 'MES@2025!';
GRANT ALL PRIVILEGES ON mes_system.* TO 'mes_user'@'localhost';
FLUSH PRIVILEGES;

-- è®¾ç½®å­—ç¬¦é›†
SET GLOBAL character_set_server = 'utf8mb4';
SET GLOBAL collation_server = 'utf8mb4_unicode_ci';
```

### 2. æ•°æ®åº“éƒ¨ç½²

#### 2.1 æ‰§è¡Œæ•°æ®åº“è„šæœ¬
```bash
# è¿›å…¥æ•°æ®åº“è„šæœ¬ç›®å½•
cd database/mysql/

# æ‰§è¡Œéƒ¨ç½²è„šæœ¬
mysql -u root -p < 01_create_database.sql
mysql -u root -p < 02_create_business_tables.sql
mysql -u root -p < 03_insert_initial_data.sql
mysql -u root -p < 04_create_indexes_and_procedures.sql
```

#### 2.2 éªŒè¯æ•°æ®åº“éƒ¨ç½²
```sql
-- è¿æ¥æ•°æ®åº“
mysql -u mes_user -p mes_system

-- æ£€æŸ¥è¡¨ç»“æ„
SHOW TABLES;

-- æ£€æŸ¥åˆå§‹æ•°æ®
SELECT COUNT(*) FROM sys_user;
SELECT COUNT(*) FROM sys_role;
SELECT COUNT(*) FROM material;
```

### 3. åº”ç”¨ç¨‹åºéƒ¨ç½²

#### 3.1 è·å–æºä»£ç 
```bash
# å…‹éš†ä»£ç ä»“åº“
git clone https://github.com/TUR1412/-MES-SON.git
cd -MES-SON

# åˆ‡æ¢åˆ°ä¸»åˆ†æ”¯
git checkout main
```

#### 3.2 ç¼–è¯‘åº”ç”¨ç¨‹åº
```bash
# ä½¿ç”¨Visual Studioç¼–è¯‘
# æˆ–ä½¿ç”¨MSBuildå‘½ä»¤è¡Œç¼–è¯‘
msbuild MES.sln /p:Configuration=Release /p:Platform="Any CPU"
```

#### 3.3 é…ç½®è¿æ¥å­—ç¬¦ä¸²
```xml
<!-- ä¿®æ”¹App.configæ–‡ä»¶ -->
<connectionStrings>
    <add name="MESConnection" 
         connectionString="Server=localhost;Database=mes_system;Uid=mes_user;Pwd=MES@2025!;CharSet=utf8mb4;" 
         providerName="MySql.Data.MySqlClient" />
</connectionStrings>
```

#### 3.4 éƒ¨ç½²åº”ç”¨ç¨‹åº
```bash
# å¤åˆ¶ç¼–è¯‘åçš„æ–‡ä»¶åˆ°éƒ¨ç½²ç›®å½•
xcopy /E /I "bin\Release\*" "C:\MES\Application\"

# åˆ›å»ºæ¡Œé¢å¿«æ·æ–¹å¼
# é…ç½®å¯åŠ¨å‚æ•°
```

### 4. éªŒè¯éƒ¨ç½²

#### 4.1 å¯åŠ¨åº”ç”¨ç¨‹åº
```bash
# è¿è¡ŒMES.UI.exe
cd C:\MES\Application\
MES.UI.exe
```

#### 4.2 ç™»å½•æµ‹è¯•
- **ç®¡ç†å‘˜è´¦å·**: admin / 123456
- **æµ‹è¯•åŠŸèƒ½**: ç‰©æ–™ç®¡ç†ã€ç”Ÿäº§è®¢å•ã€è½¦é—´ç®¡ç†

#### 4.3 æ•°æ®åº“è¿æ¥æµ‹è¯•
```csharp
// åœ¨åº”ç”¨ç¨‹åºä¸­æµ‹è¯•æ•°æ®åº“è¿æ¥
var connectionString = ConfigurationManager.ConnectionStrings["MESConnection"].ConnectionString;
using (var connection = new MySqlConnection(connectionString))
{
    connection.Open();
    // è¿æ¥æˆåŠŸ
}
```

## âš™ï¸ é…ç½®ç®¡ç†

### 1. åº”ç”¨ç¨‹åºé…ç½®

#### 1.1 æ•°æ®åº“é…ç½®
```xml
<appSettings>
    <!-- æ•°æ®åº“é…ç½® -->
    <add key="DatabaseServer" value="localhost" />
    <add key="DatabaseName" value="mes_system" />
    <add key="DatabaseUser" value="mes_user" />
    <add key="DatabasePassword" value="MES@2025!" />
    
    <!-- è¿æ¥æ± é…ç½® -->
    <add key="ConnectionPoolSize" value="100" />
    <add key="ConnectionTimeout" value="30" />
    <add key="CommandTimeout" value="60" />
</appSettings>
```

#### 1.2 æ—¥å¿—é…ç½®
```xml
<appSettings>
    <!-- æ—¥å¿—é…ç½® -->
    <add key="LogLevel" value="INFO" />
    <add key="LogPath" value="C:\MES\Logs\" />
    <add key="LogRetentionDays" value="30" />
    <add key="EnableFileLog" value="true" />
    <add key="EnableDatabaseLog" value="true" />
</appSettings>
```

#### 1.3 ç³»ç»Ÿé…ç½®
```xml
<appSettings>
    <!-- ç³»ç»Ÿé…ç½® -->
    <add key="SystemName" value="MESåˆ¶é€ æ‰§è¡Œç³»ç»Ÿ" />
    <add key="SystemVersion" value="1.0.0" />
    <add key="SessionTimeout" value="30" />
    <add key="MaxLoginAttempts" value="5" />
    <add key="PasswordMinLength" value="6" />
</appSettings>
```

### 2. æ•°æ®åº“é…ç½®

#### 2.1 æ€§èƒ½é…ç½®
```sql
-- MySQLæ€§èƒ½é…ç½®
SET GLOBAL innodb_buffer_pool_size = 1073741824; -- 1GB
SET GLOBAL max_connections = 200;
SET GLOBAL query_cache_size = 67108864; -- 64MB
SET GLOBAL slow_query_log = 1;
SET GLOBAL long_query_time = 2;
```

#### 2.2 å¤‡ä»½é…ç½®
```sql
-- å¤‡ä»½é…ç½®
SET GLOBAL backup_retention_days = 30;
SET GLOBAL backup_path = '/var/backups/mes/';
SET GLOBAL auto_backup_enabled = 1;
SET GLOBAL backup_schedule = '0 2 * * *'; -- æ¯å¤©å‡Œæ™¨2ç‚¹
```

## ğŸ“Š è¿ç»´ç›‘æ§

### 1. ç³»ç»Ÿç›‘æ§

#### 1.1 æ€§èƒ½ç›‘æ§è„šæœ¬
```sql
-- åˆ›å»ºæ€§èƒ½ç›‘æ§è§†å›¾
CREATE VIEW v_system_performance AS
SELECT 
    'Database' AS component,
    'MySQL' AS service,
    CASE WHEN @@read_only = 0 THEN 'Running' ELSE 'ReadOnly' END AS status,
    @@version AS version,
    NOW() AS check_time;

-- ç›‘æ§å­˜å‚¨è¿‡ç¨‹
DELIMITER $$
CREATE PROCEDURE sp_system_health_check()
BEGIN
    -- æ£€æŸ¥æ•°æ®åº“è¿æ¥
    SELECT 'Database Connection' AS check_item, 'OK' AS status;
    
    -- æ£€æŸ¥è¡¨ç©ºé—´
    SELECT 
        table_schema,
        ROUND(SUM(data_length + index_length) / 1024 / 1024, 2) AS size_mb
    FROM information_schema.tables 
    WHERE table_schema = 'mes_system'
    GROUP BY table_schema;
    
    -- æ£€æŸ¥æ…¢æŸ¥è¯¢
    SELECT COUNT(*) AS slow_queries
    FROM mysql.slow_log 
    WHERE start_time >= DATE_SUB(NOW(), INTERVAL 1 HOUR);
END$$
DELIMITER ;
```

#### 1.2 åº”ç”¨ç¨‹åºç›‘æ§
```csharp
// åº”ç”¨ç¨‹åºå¥åº·æ£€æŸ¥
public class HealthCheckService
{
    public HealthCheckResult CheckDatabaseConnection()
    {
        try
        {
            using (var connection = new MySqlConnection(connectionString))
            {
                connection.Open();
                return new HealthCheckResult { Status = "OK", Message = "æ•°æ®åº“è¿æ¥æ­£å¸¸" };
            }
        }
        catch (Exception ex)
        {
            return new HealthCheckResult { Status = "ERROR", Message = ex.Message };
        }
    }
    
    public HealthCheckResult CheckMemoryUsage()
    {
        var process = Process.GetCurrentProcess();
        var memoryMB = process.WorkingSet64 / 1024 / 1024;
        
        return new HealthCheckResult 
        { 
            Status = memoryMB < 500 ? "OK" : "WARNING",
            Message = $"å†…å­˜ä½¿ç”¨: {memoryMB}MB"
        };
    }
}
```

### 2. æ—¥å¿—ç›‘æ§

#### 2.1 æ—¥å¿—åˆ†æè„šæœ¬
```sql
-- é”™è¯¯æ—¥å¿—ç»Ÿè®¡
SELECT 
    log_level,
    module_name,
    COUNT(*) AS error_count,
    DATE(create_time) AS error_date
FROM sys_log 
WHERE log_level IN ('ERROR', 'FATAL')
    AND create_time >= DATE_SUB(NOW(), INTERVAL 7 DAY)
GROUP BY log_level, module_name, DATE(create_time)
ORDER BY error_date DESC, error_count DESC;

-- ç”¨æˆ·æ“ä½œç»Ÿè®¡
SELECT 
    user_name,
    operation_name,
    COUNT(*) AS operation_count,
    DATE(create_time) AS operation_date
FROM sys_log 
WHERE log_type = 'BUSINESS'
    AND create_time >= DATE_SUB(NOW(), INTERVAL 1 DAY)
GROUP BY user_name, operation_name, DATE(create_time)
ORDER BY operation_count DESC;
```

### 3. å‘Šè­¦é…ç½®

#### 3.1 æ•°æ®åº“å‘Šè­¦
```sql
-- åˆ›å»ºå‘Šè­¦æ£€æŸ¥å­˜å‚¨è¿‡ç¨‹
DELIMITER $$
CREATE PROCEDURE sp_check_alerts()
BEGIN
    DECLARE alert_count INT DEFAULT 0;
    
    -- æ£€æŸ¥ç£ç›˜ç©ºé—´
    -- æ£€æŸ¥è¿æ¥æ•°
    -- æ£€æŸ¥æ…¢æŸ¥è¯¢
    -- æ£€æŸ¥é”™è¯¯æ—¥å¿—
    
    -- å‘é€å‘Šè­¦ï¼ˆéœ€è¦åœ¨åº”ç”¨å±‚å®ç°ï¼‰
    IF alert_count > 0 THEN
        INSERT INTO sys_log (log_level, log_type, module_name, operation_name, log_message)
        VALUES ('WARNING', 'ALERT', 'SYSTEM', 'HEALTH_CHECK', 
                CONCAT('å‘ç° ', alert_count, ' ä¸ªç³»ç»Ÿå‘Šè­¦'));
    END IF;
END$$
DELIMITER ;
```

## ğŸ’¾ å¤‡ä»½æ¢å¤

### 1. å¤‡ä»½ç­–ç•¥

#### 1.1 è‡ªåŠ¨å¤‡ä»½è„šæœ¬
```bash
#!/bin/bash
# MESæ•°æ®åº“è‡ªåŠ¨å¤‡ä»½è„šæœ¬

BACKUP_DIR="/var/backups/mes"
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="mes_system_full_${DATE}.sql"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# æ‰§è¡Œå¤‡ä»½
mysqldump -u mes_user -p --single-transaction --routines --triggers \
    --events --hex-blob --default-character-set=utf8mb4 \
    mes_system > $BACKUP_DIR/$BACKUP_FILE

# å‹ç¼©å¤‡ä»½æ–‡ä»¶
gzip $BACKUP_DIR/$BACKUP_FILE

# åˆ é™¤7å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "*.sql.gz" -mtime +7 -delete

# è®°å½•å¤‡ä»½æ—¥å¿—
echo "$(date): å¤‡ä»½å®Œæˆ - $BACKUP_FILE.gz" >> $BACKUP_DIR/backup.log
```

#### 1.2 Windowså¤‡ä»½è„šæœ¬
```batch
@echo off
REM MESæ•°æ®åº“Windowså¤‡ä»½è„šæœ¬

set BACKUP_DIR=C:\MES\Backups
set DATE=%date:~0,4%%date:~5,2%%date:~8,2%_%time:~0,2%%time:~3,2%%time:~6,2%
set BACKUP_FILE=mes_system_full_%DATE%.sql

REM åˆ›å»ºå¤‡ä»½ç›®å½•
if not exist %BACKUP_DIR% mkdir %BACKUP_DIR%

REM æ‰§è¡Œå¤‡ä»½
mysqldump -u mes_user -p --single-transaction --routines --triggers ^
    --events --hex-blob --default-character-set=utf8mb4 ^
    mes_system > %BACKUP_DIR%\%BACKUP_FILE%

REM è®°å½•æ—¥å¿—
echo %date% %time%: å¤‡ä»½å®Œæˆ - %BACKUP_FILE% >> %BACKUP_DIR%\backup.log
```

### 2. æ¢å¤æµç¨‹

#### 2.1 å®Œæ•´æ¢å¤
```bash
# 1. åœæ­¢åº”ç”¨ç¨‹åº
# 2. åˆ›å»ºæ¢å¤ç‚¹
mysqldump -u mes_user -p mes_system > /var/backups/mes/restore_point_$(date +%Y%m%d_%H%M%S).sql

# 3. æ‰§è¡Œæ¢å¤
mysql -u mes_user -p mes_system < /var/backups/mes/mes_system_full_20250606_020000.sql

# 4. éªŒè¯æ¢å¤ç»“æœ
mysql -u mes_user -p -e "SELECT COUNT(*) FROM mes_system.sys_user;"

# 5. é‡å¯åº”ç”¨ç¨‹åº
```

#### 2.2 æ•°æ®æ¢å¤
```sql
-- ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹æ¢å¤
CALL sp_restore_database_full(
    '/var/backups/mes/mes_system_full_20250606_020000.sql',
    'admin',
    TRUE,
    'ç³»ç»Ÿæ•…éšœæ¢å¤'
);
```

## ğŸ” æ•…éšœæ’é™¤

### 1. å¸¸è§é—®é¢˜

#### 1.1 æ•°æ®åº“è¿æ¥é—®é¢˜
```sql
-- æ£€æŸ¥MySQLæœåŠ¡çŠ¶æ€
SHOW PROCESSLIST;

-- æ£€æŸ¥ç”¨æˆ·æƒé™
SHOW GRANTS FOR 'mes_user'@'localhost';

-- æ£€æŸ¥è¿æ¥æ•°
SHOW STATUS LIKE 'Threads_connected';
SHOW VARIABLES LIKE 'max_connections';
```

#### 1.2 åº”ç”¨ç¨‹åºé—®é¢˜
```csharp
// è¿æ¥å­—ç¬¦ä¸²æ£€æŸ¥
var connectionString = ConfigurationManager.ConnectionStrings["MESConnection"].ConnectionString;
Console.WriteLine($"è¿æ¥å­—ç¬¦ä¸²: {connectionString}");

// æ•°æ®åº“è¿æ¥æµ‹è¯•
try
{
    using (var connection = new MySqlConnection(connectionString))
    {
        connection.Open();
        Console.WriteLine("æ•°æ®åº“è¿æ¥æˆåŠŸ");
    }
}
catch (Exception ex)
{
    Console.WriteLine($"æ•°æ®åº“è¿æ¥å¤±è´¥: {ex.Message}");
}
```

### 2. æ€§èƒ½é—®é¢˜

#### 2.1 æ…¢æŸ¥è¯¢åˆ†æ
```sql
-- å¯ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—
SET GLOBAL slow_query_log = 1;
SET GLOBAL long_query_time = 2;

-- æŸ¥çœ‹æ…¢æŸ¥è¯¢
SELECT * FROM mysql.slow_log ORDER BY start_time DESC LIMIT 10;

-- åˆ†ææŸ¥è¯¢æ‰§è¡Œè®¡åˆ’
EXPLAIN SELECT * FROM material WHERE material_type = 'RAW_MATERIAL';
```

#### 2.2 ç´¢å¼•ä¼˜åŒ–
```sql
-- æ£€æŸ¥ç´¢å¼•ä½¿ç”¨æƒ…å†µ
SHOW INDEX FROM material;

-- åˆ†æè¡¨ç»Ÿè®¡ä¿¡æ¯
ANALYZE TABLE material;

-- ä¼˜åŒ–è¡¨
OPTIMIZE TABLE material;
```

## âš¡ æ€§èƒ½ä¼˜åŒ–

### 1. æ•°æ®åº“ä¼˜åŒ–

#### 1.1 é…ç½®ä¼˜åŒ–
```sql
-- InnoDBé…ç½®
SET GLOBAL innodb_buffer_pool_size = 2147483648; -- 2GB
SET GLOBAL innodb_log_file_size = 268435456; -- 256MB
SET GLOBAL innodb_flush_log_at_trx_commit = 2;

-- æŸ¥è¯¢ç¼“å­˜
SET GLOBAL query_cache_type = 1;
SET GLOBAL query_cache_size = 134217728; -- 128MB

-- è¿æ¥é…ç½®
SET GLOBAL max_connections = 300;
SET GLOBAL wait_timeout = 28800;
```

#### 1.2 ç´¢å¼•ä¼˜åŒ–
```sql
-- åˆ›å»ºå¤åˆç´¢å¼•
CREATE INDEX idx_material_type_status ON material (material_type, status);
CREATE INDEX idx_production_time_status ON production_order (planned_start_time, status);

-- åˆ é™¤æœªä½¿ç”¨çš„ç´¢å¼•
-- å®šæœŸåˆ†æç´¢å¼•ä½¿ç”¨æƒ…å†µ
```

### 2. åº”ç”¨ç¨‹åºä¼˜åŒ–

#### 2.1 è¿æ¥æ± é…ç½®
```xml
<connectionStrings>
    <add name="MESConnection" 
         connectionString="Server=localhost;Database=mes_system;Uid=mes_user;Pwd=MES@2025!;CharSet=utf8mb4;Pooling=true;Min Pool Size=5;Max Pool Size=100;Connection Timeout=30;" 
         providerName="MySql.Data.MySqlClient" />
</connectionStrings>
```

#### 2.2 ç¼“å­˜ç­–ç•¥
```csharp
// å®ç°æ•°æ®ç¼“å­˜
public class CacheService
{
    private static readonly MemoryCache _cache = new MemoryCache();
    
    public T Get<T>(string key) where T : class
    {
        return _cache.Get(key) as T;
    }
    
    public void Set<T>(string key, T value, TimeSpan expiration)
    {
        _cache.Set(key, value, expiration);
    }
}
```

## ğŸ”’ å®‰å…¨ç®¡ç†

### 1. æ•°æ®åº“å®‰å…¨

#### 1.1 ç”¨æˆ·æƒé™ç®¡ç†
```sql
-- åˆ›å»ºåªè¯»ç”¨æˆ·
CREATE USER 'mes_readonly'@'localhost' IDENTIFIED BY 'ReadOnly@2025!';
GRANT SELECT ON mes_system.* TO 'mes_readonly'@'localhost';

-- åˆ›å»ºå¤‡ä»½ç”¨æˆ·
CREATE USER 'mes_backup'@'localhost' IDENTIFIED BY 'Backup@2025!';
GRANT SELECT, LOCK TABLES, SHOW VIEW ON mes_system.* TO 'mes_backup'@'localhost';

-- å®šæœŸæ›´æ–°å¯†ç 
ALTER USER 'mes_user'@'localhost' IDENTIFIED BY 'NewPassword@2025!';
```

#### 1.2 æ•°æ®åŠ å¯†
```sql
-- å¯ç”¨SSLè¿æ¥
-- é…ç½®æ•°æ®åŠ å¯†
-- è®¾ç½®å®¡è®¡æ—¥å¿—
```

### 2. åº”ç”¨ç¨‹åºå®‰å…¨

#### 2.1 å¯†ç å®‰å…¨
```csharp
// å¯†ç åŠ å¯†
public class PasswordHelper
{
    public static string HashPassword(string password, string salt)
    {
        using (var md5 = MD5.Create())
        {
            var input = Encoding.UTF8.GetBytes(password + salt);
            var hash = md5.ComputeHash(input);
            return Convert.ToBase64String(hash);
        }
    }
    
    public static bool VerifyPassword(string password, string salt, string hash)
    {
        return HashPassword(password, salt) == hash;
    }
}
```

#### 2.2 è®¿é—®æ§åˆ¶
```csharp
// æƒé™éªŒè¯
public class PermissionService
{
    public bool HasPermission(string userCode, string permission)
    {
        // æ£€æŸ¥ç”¨æˆ·æƒé™
        // éªŒè¯è§’è‰²æƒé™
        // è¿”å›éªŒè¯ç»“æœ
        return true;
    }
}
```

---

**æŠ€æœ¯æ”¯æŒ**: MESå¼€å‘å›¢é˜Ÿ  
**è”ç³»æ–¹å¼**: mes-support@company.com  
**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-06-06
