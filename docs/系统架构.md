# MES制造执行系统 - 系统架构文档

> **最后更新**: 2025-06-07 23:09
> **维护者**: 天帝（组长）
> **版本**: v1.3.0

## 📋 目录
- [架构概述](#架构概述)
- [技术栈](#技术栈)
- [系统分层](#系统分层)
- [数据库设计](#数据库设计)
- [核心模块](#核心模块)
- [部署架构](#部署架构)

## 🏗️ 架构概述

MES制造执行系统采用经典的三层架构设计，具有良好的可维护性和可扩展性。

### 架构图
```
┌─────────────────────────────────────────────────────────┐
│                    用户界面层 (UI)                        │
│                  Windows Forms                         │
└─────────────────────┬───────────────────────────────────┘
                      │
┌─────────────────────┴───────────────────────────────────┐
│                  业务逻辑层 (BLL)                        │
│              Business Logic Layer                      │
└─────────────────────┬───────────────────────────────────┘
                      │
┌─────────────────────┴───────────────────────────────────┐
│                  数据访问层 (DAL)                        │
│               Data Access Layer                        │
└─────────────────────┬───────────────────────────────────┘
                      │
┌─────────────────────┴───────────────────────────────────┐
│                    数据库层                              │
│                   MySQL 8.0                           │
└─────────────────────────────────────────────────────────┘
```

## 🛠️ 技术栈

### 开发技术
- **开发语言**: C# (.NET Framework 4.8)
- **UI框架**: Windows Forms (WinForms)
- **数据库**: MySQL 8.0
- **ORM**: 自定义数据访问层
- **开发工具**: Visual Studio 2022
- **版本控制**: Git + GitHub

### 依赖包
- **MySQL.Data**: 9.3.0 - MySQL数据库连接
- **System.Configuration.ConfigurationManager**: 9.0.5 - 配置管理
- **其他依赖**: 详见各项目的packages.config

## 📚 系统分层

### 1. 用户界面层 (MES.UI) - v1.3.0架构升级
**职责**: 用户交互、数据展示、输入验证
**架构模式**: 标准WinForms设计器模式（v1.3.0重构）

- **主窗体**: `MainForm.cs` + `MainForm.Designer.cs` - 系统主界面
- **功能模块**:
  - `Forms/Material/` - 物料管理界面
  - `Forms/Production/` - 生产管理界面
  - `Forms/Workshop/` - 车间管理界面
  - `Forms/SystemManagement/` - 系统管理界面（v1.3.0重构为设计器模式）

#### UI开发架构特点（v1.3.0）
- **设计器优先**: 所有控件在Visual Studio设计器中创建和编辑
- **代码分离**: 界面定义(.Designer.cs) 与业务逻辑(.cs) 完全分离
- **可视化开发**: 支持拖拽式界面设计，提升开发效率
- **标准化模式**: 遵循WinForms最佳实践，便于团队协作

#### 文件结构规范
```
Forms/
├── SystemManagement/
│   ├── SystemConfigForm.cs           # 主逻辑文件
│   ├── SystemConfigForm.Designer.cs  # 设计器文件
│   └── SystemConfigForm.resx         # 资源文件（如需要）
```

### 2. UI框架层 (MES.UI.Framework)
**职责**: 通用UI组件、主题管理、工具类
- **通用控件**: `Controls/` - 自定义控件
- **主题管理**: `Themes/` - UI主题和样式
- **工具类**: `Utilities/` - UI辅助工具

### 3. 业务逻辑层 (MES.BLL)
**职责**: 核心业务逻辑、业务规则验证、数据处理
- **物料管理**: `Material/MaterialBLL.cs`, `Material/BOMBLL.cs`
- **生产管理**: `Production/ProductionOrderBLL.cs`
- **车间管理**: `Workshop/WorkshopBLL.cs`, `Workshop/BatchBLL.cs`
- **设备管理**: `Equipment/EquipmentBLL.cs`
- **质量管理**: `Quality/QualityInspectionBLL.cs`
- **系统管理**: `System/RoleBLL.cs`

### 4. 数据访问层 (MES.DAL)
**职责**: 数据库操作、SQL执行、数据映射
- **基础类**: `Base/BaseDAL.cs` - 通用数据访问基类
- **核心工具**: `Core/DatabaseHelper.cs` - 数据库连接和操作
- **模块DAL**: 对应各业务模块的数据访问实现

### 5. 数据模型层 (MES.Models)
**职责**: 数据实体定义、业务对象
- **物料模型**: `Material/MaterialInfo.cs`
- **生产模型**: `Production/ProductionOrderInfo.cs`
- **车间模型**: `Workshop/WorkshopInfo.cs`, `Workshop/BatchInfo.cs`
- **设备模型**: `Equipment/EquipmentInfo.cs`
- **质量模型**: `Quality/QualityInspectionInfo.cs`
- **系统模型**: `System/RoleInfo.cs`, `System/DictionaryInfo.cs`

### 6. 公共组件层 (MES.Common)
**职责**: 通用工具、配置管理、异常处理
- **配置管理**: `Configuration/ConfigManager.cs`
- **日志管理**: `Logging/LogManager.cs`
- **异常处理**: `Exceptions/MESException.cs`

## 🗄️ 数据库设计

### 核心表结构

#### 系统管理表
- `sys_user` - 用户信息表
- `sys_role` - 角色信息表
- `sys_dictionary` - 数据字典表

#### 物料管理表
- `material_info` - 物料信息表
- `bom_info` - BOM物料清单表

#### 生产管理表
- `production_order` - 生产订单表
- `quality_inspection` - 质量检验表

#### 车间管理表
- `workshop_info` - 车间信息表
- `batch_info` - 批次信息表
- `equipment_info` - 设备信息表

### 数据库脚本
- `database/mysql/01_create_database.sql` - 数据库创建
- `database/mysql/02_create_business_tables.sql` - 业务表创建
- `database/mysql/03_insert_initial_data.sql` - 初始数据
- `database/mysql/04_create_indexes_and_procedures.sql` - 索引和存储过程

## 🔧 核心模块

### 物料管理模块 (L成员负责)
- **功能**: 物料信息管理、BOM管理、工艺路线
- **核心类**: `MaterialBLL`, `MaterialDAL`, `MaterialInfo`
- **主要界面**: `MaterialManagementForm`

### 生产管理模块 (H成员负责)
- **功能**: 生产订单管理、生产执行、质量检验
- **核心类**: `ProductionOrderBLL`, `QualityInspectionBLL`
- **主要界面**: 生产订单窗体、质量检验窗体

### 车间管理模块 (S成员负责)
- **功能**: 车间作业、批次管理、设备管理
- **核心类**: `WorkshopBLL`, `BatchBLL`, `EquipmentBLL`
- **主要界面**: `WorkshopManagementForm`, 设备管理窗体

### 系统管理模块
- **功能**: 用户管理、角色权限、系统配置
- **核心类**: `RoleBLL`, 用户管理相关类
- **主要界面**: `RoleManagementForm`

## 🚀 部署架构

### 开发环境
- **操作系统**: Windows 10/11
- **开发工具**: Visual Studio 2022
- **数据库**: MySQL 8.0 (本地或远程)
- **版本控制**: Git

### 生产环境（规划）
- **应用服务器**: Windows Server
- **数据库服务器**: MySQL 8.0
- **部署方式**: 单机部署或分布式部署

### 配置管理
- **连接字符串**: `App.config` 中配置
- **系统参数**: 数据库 `sys_dictionary` 表管理
- **日志配置**: `LogManager` 类统一管理

## 📈 扩展性设计

### 模块化设计
- 各业务模块相对独立
- 通过接口定义模块间交互
- 支持模块级别的扩展和替换

### 数据访问抽象
- `BaseDAL` 提供通用数据访问方法
- 支持多种数据库类型扩展
- 统一的异常处理和日志记录

### UI框架扩展
- `MES.UI.Framework` 提供通用UI组件
- 支持主题和样式定制
- 可扩展的控件库

---

**📞 技术支持**: 如需了解更多架构细节，请联系天帝（组长）
**🔄 版本**: v1.3.0 - UI架构标准化版本
