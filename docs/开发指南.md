# MES制造执行系统 - 开发指南

> **最后更新**: 2025-06-07 19:14
> **维护者**: 天帝（组长）

## 📋 目录
- [项目概述](#项目概述)
- [开发环境配置](#开发环境配置)
- [Git工作流程](#git工作流程)
- [代码规范](#代码规范)
- [团队分工](#团队分工)
- [常见问题](#常见问题)

## 🎯 项目概述

### 技术架构
- **UI层**: Windows Forms (WinForms) - 用户界面层
- **业务逻辑层(BLL)**: C# 类库 - 核心业务逻辑处理
- **数据访问层(DAL)**: C# 类库 - 数据库操作封装
- **数据模型层(Models)**: C# 类库 - 数据实体定义
- **公共组件层(Common)**: C# 类库 - 通用工具和配置
- **数据库**: MySQL 8.0 - 数据存储

### 项目结构
```
MES-SON/
├── 📁 src/                          # 源代码目录
│   ├── 📁 MES.UI/                   # 用户界面层
│   ├── 📁 MES.BLL/                  # 业务逻辑层
│   ├── 📁 MES.DAL/                  # 数据访问层
│   ├── 📁 MES.Models/               # 数据模型层
│   ├── 📁 MES.Common/               # 公共组件层
│   └── 📁 MES.UI.Framework/         # UI框架层
├── 📁 database/                     # 数据库脚本
├── 📁 docs/                         # 文档目录
├── 📁 tests/                        # 测试项目
└── 📄 MES.sln                       # 解决方案文件
```

## 🔧 开发环境配置

### 必需软件
1. **Visual Studio 2022** (推荐) 或 **Visual Studio 2019**
   - 包含 .NET Framework 4.8 开发工具
   - 包含 NuGet 包管理器
   - 包含 Git 集成

2. **Git for Windows**
   - 用于版本控制和团队协作

3. **MySQL 8.0** (可选)
   - 仅在需要本地数据库测试时安装

### 快速开始
```bash
# 1. 克隆项目
git clone https://github.com/TUR1412/-MES-SON.git
cd MES-SON

# 2. 切换到develop分支（主要工作分支）
git checkout develop
git pull origin develop

# 3. 使用Visual Studio打开解决方案
start MES.sln
```

### 编译验证
1. 使用 Visual Studio 打开 `MES.sln`
2. 右键解决方案 → "还原 NuGet 包"
3. 生成 → "重新生成解决方案"
4. 确保无编译错误

## 🔄 Git工作流程

### 分支策略（简化双分支模式）
```
📦 MES项目仓库
├── 🔥 main分支 (生产稳定版)
└── 🚀 develop分支 (主要工作分支)
```

### 日常开发流程

#### 🌅 每天开始工作
```bash
# 1. 确保在develop分支
git checkout develop

# 2. 拉取最新更改
git pull origin develop

# 3. 开始编码...
```

#### 🌆 开发完成后
```bash
# 1. 添加所有更改
git add .

# 2. 提交更改
git commit -m "成员标识: 模块 - 完成的功能描述"

# 3. 推送前先拉取最新代码（避免冲突）
git pull origin develop

# 4. 推送到develop分支
git push origin develop
```

### 提交规范

#### 🏷️ 提交消息格式
```
成员标识: 功能模块 - 具体描述

示例:
L: 物料管理 - 添加物料信息CRUD功能
H: 生产管理 - 实现生产订单状态更新
S: 车间管理 - 完成设备状态监控界面
天帝: 系统架构 - 优化数据库连接池配置
```

#### ✅ 提交最佳实践
- **频繁提交**: 每完成一个小功能就提交
- **清晰描述**: 提交消息要说明做了什么
- **原子提交**: 每次提交只包含一个逻辑变更
- **测试通过**: 提交前确保代码可以编译运行
- **推送前拉取**: 推送前先拉取最新代码，避免冲突

### 冲突解决
```bash
# 1. 拉取最新代码时如果有冲突
git pull origin develop

# 2. 解决冲突文件（编辑器会标记冲突部分）
# 3. 添加解决后的文件
git add .

# 4. 提交合并
git commit -m "解决合并冲突"

# 5. 推送
git push origin develop
```

## 📝 代码规范

### 命名规范
- **类名**: PascalCase (例: `MaterialInfo`, `ProductionOrderBLL`)
- **方法名**: PascalCase (例: `GetMaterialList`, `UpdateOrderStatus`)
- **属性名**: PascalCase (例: `MaterialId`, `OrderName`)
- **字段名**: camelCase (例: `materialId`, `orderStatus`)
- **常量**: UPPER_CASE (例: `MAX_RETRY_COUNT`)

### 注释要求
- **所有公共API**: 必须有XML文档注释
- **复杂逻辑**: 必须有详细注释说明
- **业务规则**: 必须注释说明业务含义
- **数据库操作**: 必须注释SQL语句的作用

### 异常处理
- 使用统一的MES异常处理机制
- 关键操作必须记录日志
- 数据库操作必须有事务处理

## 👥 团队分工

| 成员 | 职责 | 负责模块 | 主要文件路径 |
|------|------|----------|-------------|
| **天帝 (组长)** | 系统架构、代码审查、技术决策 | 框架设计、项目管理 | `MES.Common/`, `MES.UI.Framework/` |
| **L 成员** | 物料与工艺规则配置 | 物料管理、BOM管理 | `*/Material/`, `*/BOM/` |
| **H 成员** | 生产订单与执行核心 | 生产订单、生产执行 | `*/Production/`, `*/Quality/` |
| **S 成员** | 车间作业与辅助管理 | 车间作业、设备管理 | `*/Workshop/`, `*/Equipment/` |

### 协作原则
- **避免冲突**: 尽量不要同时修改相同文件
- **主动沟通**: 修改共享文件前先沟通
- **及时同步**: 每天开始工作前拉取最新代码
- **代码审查**: 重要功能完成后请组长审查

## 🆘 常见问题

### Q: 推送时遇到冲突怎么办？
```bash
# 1. 拉取最新代码
git pull origin develop
# 2. 解决冲突文件（编辑器会标记冲突部分）
# 3. 添加解决后的文件
git add .
# 4. 提交合并
git commit -m "解决合并冲突"
# 5. 推送
git push origin develop
```

### Q: 编译错误：找不到 MySQL.Data
**解决**: 在 Visual Studio 中还原 NuGet 包

### Q: 如何查看其他成员的最新提交？
```bash
# 查看最近的提交历史
git log --oneline -10
# 查看特定成员的提交
git log --author="成员名" --oneline -5
```

### Q: 提交了错误的代码怎么办？
```bash
# 撤销最后一次提交（保留更改）
git reset --soft HEAD~1
# 撤销最后一次提交（丢弃更改）
git reset --hard HEAD~1
```

---

**📞 技术支持**: 如遇问题请联系天帝（组长）  
**📚 更多文档**: 详见 `docs/` 目录下的其他文档
