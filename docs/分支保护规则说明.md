# 🔒 MES项目分支保护规则说明

> **生效时间：2025-06-05 14:08**  
> **配置者：天帝（组长）**

## 📢 重要通知

**从即日起，MES项目的develop和main分支已启用GitHub分支保护规则！**

这意味着：
- ❌ **不能直接推送到这些分支**
- ✅ **必须通过Pull Request进行代码合并**
- ✅ **必须通过GitHub Actions构建检查**
- ✅ **必须获得代码审查批准**

## 🛡️ 保护规则详情

### develop分支保护
- ✅ **强制PR审查**：至少需要1个审查批准
- ✅ **GitHub Actions检查**：必须通过构建检查
- ✅ **禁止直接推送**：只能通过PR合并
- ✅ **禁止强制推送**：保护代码历史
- ✅ **自动解散过期审查**：代码更新后需重新审查
- ✅ **要求分支最新**：合并前必须基于最新的develop

### main分支保护
- ✅ **强制PR审查**：至少需要1个审查批准
- ✅ **GitHub Actions检查**：必须通过构建检查
- ✅ **禁止直接推送**：只能通过PR合并
- ✅ **禁止强制推送**：保护生产代码
- ✅ **自动解散过期审查**：代码更新后需重新审查
- ✅ **要求分支最新**：合并前必须基于最新的main

## ❌ 被禁止的操作

以下Git命令将被GitHub服务器拒绝：

```bash
# 直接推送到受保护分支
git push origin develop        # ❌ 被拒绝
git push origin main          # ❌ 被拒绝

# 强制推送到受保护分支
git push --force origin develop  # ❌ 被拒绝
git push --force origin main     # ❌ 被拒绝

# 删除受保护分支
git push origin --delete develop # ❌ 被拒绝
git push origin --delete main    # ❌ 被拒绝
```

## ✅ 正确的工作流程

### 1. 日常开发流程
```bash
# 在功能分支开发（正常）
git checkout feature/你的分支名
git add .
git commit -m "你的提交信息"
git push origin feature/你的分支名  # ✅ 允许
```

### 2. 合并到develop流程
```bash
# 1. 推送功能分支
git push origin feature/你的分支名

# 2. 在GitHub网页上创建Pull Request
#    - 源分支：feature/你的分支名
#    - 目标分支：develop

# 3. 等待GitHub Actions检查通过
# 4. 等待代码审查批准
# 5. 在GitHub网页上点击"Merge pull request"
```

## 🔍 GitHub Actions检查

每个PR都必须通过以下检查：

### 构建检查内容
- ✅ **代码编译**：确保所有项目能正常编译
- ✅ **NuGet包还原**：验证依赖项正确
- ✅ **Release模式构建**：确保生产环境兼容
- ✅ **项目引用完整性**：验证项目间引用正确

### 检查失败处理
如果GitHub Actions检查失败：
1. 查看失败日志
2. 在功能分支修复问题
3. 重新推送，检查会自动重新运行
4. 直到所有检查通过

## 👥 代码审查流程

### 审查要求
- **至少1个批准**：任何团队成员都可以审查
- **审查内容**：代码质量、功能正确性、规范性
- **自动解散**：代码更新后需重新审查

### 审查者职责
- 检查代码风格和质量
- 验证功能实现正确性
- 确认没有明显bug或安全问题
- 提供建设性的改进建议

## 🚨 常见错误和解决方案

### 错误1：推送被拒绝
```bash
$ git push origin develop
remote: error: GH006: Protected branch update failed for refs/heads/develop.
remote: error: Required status check "build" is expected.
```

**解决方案**：
1. 推送到功能分支：`git push origin feature/你的分支名`
2. 创建Pull Request
3. 等待检查和审查通过

### 错误2：PR无法合并
```
This branch has conflicts that must be resolved
```

**解决方案**：
```bash
# 1. 同步最新的develop分支
git checkout develop
git pull origin develop

# 2. 合并到功能分支
git checkout feature/你的分支名
git merge develop

# 3. 解决冲突后推送
git add .
git commit -m "解决合并冲突"
git push origin feature/你的分支名
```

### 错误3：GitHub Actions检查失败
**解决方案**：
1. 点击PR页面的"Details"查看失败原因
2. 在功能分支修复问题
3. 推送修复，检查会自动重新运行

## 📞 获取帮助

如果遇到问题：
1. **查看本文档**：大部分问题都有解决方案
2. **查看GitHub Actions日志**：了解具体错误信息
3. **联系天帝**：复杂问题可以寻求帮助
4. **团队讨论**：在团队群里讨论技术问题

## 🎯 保护规则的好处

### 代码质量保障
- 所有代码都经过审查
- 自动化测试确保构建正常
- 防止有问题的代码进入主分支

### 团队协作规范
- 强制使用PR流程
- 促进代码审查文化
- 提高团队代码质量意识

### 风险控制
- 防止意外的直接推送
- 保护重要分支的历史
- 确保生产代码稳定性

---

**配置时间**：2025年6月5日 14:08  
**维护者**：天帝（组长）  
**适用范围**：所有MES项目团队成员
