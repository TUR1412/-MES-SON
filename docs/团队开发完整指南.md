# MES团队开发完整指南

> **更新时间：2025-06-06 08:52**
> **状态：✅ 架构完全就绪，团队可全速开发**

## 🎯 当前项目状态总览

### ✅ 已完成的核心基础设施（100%）
- **MES.Common** - 日志、异常、配置管理 ✅
- **MES.Models** - 基础模型、物料模型、生产模型、车间模型 ✅
- **MES.DAL** - MySQL架构统一，企业级数据访问层 ✅
- **MES.BLL** - L成员物料管理业务逻辑 ✅

### 🚧 进行中的开发任务
- **L成员** - 物料管理UI开发（MaterialManagementForm已创建）
- **H成员** - 生产管理BLL层开发（模型类已就绪）
- **S成员** - 车间管理BLL层开发（模型类已就绪）

## 👥 团队成员详细任务分配

### 🔥 L成员（物料管理）- UI开发阶段

#### 当前状态
- ✅ MaterialBLL.cs, BOMBLL.cs 已完成
- ✅ MaterialManagementForm.cs 已创建框架
- 🚧 需要集成BLL层，实现完整UI功能

#### 立即任务清单
```csharp
// 1. 完善MaterialManagementForm.cs
位置：src/MES.UI/Forms/Material/MaterialManagementForm.cs

需要实现：
- 物料列表显示（DataGridView）
- 搜索和筛选功能
- 添加/编辑/删除操作
- BLL层集成调用

// 2. 集成BLL层示例代码
using MES.BLL.Material;
using MES.Models.Material;

private MaterialBLL materialBLL = new MaterialBLL();

// 加载物料列表
private void LoadMaterialList()
{
    try
    {
        var materials = materialBLL.GetAll();
        dataGridView1.DataSource = materials;
    }
    catch (Exception ex)
    {
        MessageBox.Show($"加载物料列表失败：{ex.Message}");
    }
}
```

#### 开发参考
- **BLL调用示例**：参考已完成的MaterialBLL.cs方法
- **UI设计模式**：参考MainForm.cs的混合架构
- **异常处理**：统一使用try-catch + MessageBox显示

### ⚡ H成员（生产管理）- BLL层开发

#### 当前状态
- ✅ ProductionOrderInfo.cs 模型已创建
- ✅ ProductionOrderDAL.cs 已修复MySQL API
- 🚧 需要创建BLL层接口和实现

#### 立即任务清单
```csharp
// 1. 创建接口文件
位置：src/MES.BLL/Production/IProductionOrderBLL.cs

using System;
using System.Collections.Generic;
using MES.Models.Production;

namespace MES.BLL.Production
{
    public interface IProductionOrderBLL
    {
        bool Add(ProductionOrderInfo entity);
        bool Update(ProductionOrderInfo entity);
        bool Delete(int id);
        ProductionOrderInfo GetById(int id);
        List<ProductionOrderInfo> GetAll();
        ProductionOrderInfo GetByOrderNo(string orderNo);
        List<ProductionOrderInfo> GetByStatus(string status);
        bool UpdateStatus(int id, string status);
        List<ProductionOrderInfo> GetByDateRange(DateTime startDate, DateTime endDate);
    }
}

// 2. 创建实现文件
位置：src/MES.BLL/Production/ProductionOrderBLL.cs

using System;
using System.Collections.Generic;
using MES.Models.Production;
using MES.DAL.Production;
using MES.Common.Logging;
using MES.Common.Exceptions;

namespace MES.BLL.Production
{
    public class ProductionOrderBLL : IProductionOrderBLL
    {
        private readonly ProductionOrderDAL _productionOrderDAL;

        public ProductionOrderBLL()
        {
            _productionOrderDAL = new ProductionOrderDAL();
        }

        public bool Add(ProductionOrderInfo entity)
        {
            try
            {
                // 业务验证
                if (string.IsNullOrEmpty(entity.OrderNo))
                {
                    throw new MESException("订单编号不能为空");
                }

                // 检查订单编号是否重复
                var existing = _productionOrderDAL.GetByOrderNo(entity.OrderNo);
                if (existing != null)
                {
                    throw new MESException("订单编号已存在");
                }

                return _productionOrderDAL.Add(entity);
            }
            catch (Exception ex)
            {
                LogManager.Error("添加生产订单失败", ex);
                throw;
            }
        }

        // 其他方法实现...
    }
}
```

#### 业务逻辑要点
- **订单编号唯一性验证**
- **状态流转控制**（待开始→进行中→已完成）
- **数量验证**（完成数量不能超过计划数量）
- **时间逻辑验证**（开始时间不能晚于结束时间）

### 🚀 S成员（车间管理）- BLL层开发

#### 当前状态
- ✅ WorkshopInfo.cs 模型已创建
- ✅ WorkshopDAL.cs 已修复MySQL API
- 🚧 需要创建BLL层接口和实现

#### 立即任务清单
```csharp
// 1. 创建接口文件
位置：src/MES.BLL/Workshop/IWorkshopBLL.cs

using System;
using System.Collections.Generic;
using MES.Models.Workshop;

namespace MES.BLL.Workshop
{
    public interface IWorkshopBLL
    {
        bool Add(WorkshopInfo entity);
        bool Update(WorkshopInfo entity);
        bool Delete(int id);
        WorkshopInfo GetById(int id);
        List<WorkshopInfo> GetAll();
        WorkshopInfo GetByWorkshopCode(string workshopCode);
        List<WorkshopInfo> GetByStatus(string status);
        bool UpdateWorkshopStatus(int id, string status);
        List<WorkshopInfo> GetByDepartment(string department);
    }
}

// 2. 创建实现文件
位置：src/MES.BLL/Workshop/WorkshopBLL.cs

using System;
using System.Collections.Generic;
using MES.Models.Workshop;
using MES.DAL.Workshop;
using MES.Common.Logging;
using MES.Common.Exceptions;

namespace MES.BLL.Workshop
{
    public class WorkshopBLL : IWorkshopBLL
    {
        private readonly WorkshopDAL _workshopDAL;

        public WorkshopBLL()
        {
            _workshopDAL = new WorkshopDAL();
        }

        public bool Add(WorkshopInfo entity)
        {
            try
            {
                // 业务验证
                if (string.IsNullOrEmpty(entity.WorkshopCode))
                {
                    throw new MESException("车间编码不能为空");
                }

                // 检查车间编码是否重复
                var existing = _workshopDAL.GetByWorkshopCode(entity.WorkshopCode);
                if (existing != null)
                {
                    throw new MESException("车间编码已存在");
                }

                return _workshopDAL.Add(entity);
            }
            catch (Exception ex)
            {
                LogManager.Error("添加车间信息失败", ex);
                throw;
            }
        }

        // 其他方法实现...
    }
}
```

#### 业务逻辑要点
- **车间编码唯一性验证**
- **产能合理性检查**（设备数量与产能的关系）
- **状态变更控制**（正常运行↔维护中↔故障停机）
- **安全等级验证**

## 🔧 开发环境配置

### Git工作流程
```bash
# 1. 更新本地develop分支
git checkout develop
git pull origin develop

# 2. 创建功能分支
git checkout -b feature/成员-模块名称

# 3. 每日提交
git add .
git commit -m "成员标识: 模块 - 功能描述"
git push origin feature/成员-模块名称

# 4. 完成后创建PR
# 在GitHub上创建Pull Request到develop分支
```

### 编译验证
```bash
# 验证各层编译
dotnet build src/MES.Models/MES.Models.csproj  # ✅ 通过
dotnet build src/MES.DAL/MES.DAL.csproj        # ✅ 通过
dotnet build src/MES.BLL/MES.BLL.csproj        # ✅ 通过
```

### 数据库连接配置
```xml
<!-- App.config 示例 -->
<connectionStrings>
  <add name="MESConnectionString"
       connectionString="Server=localhost;Database=MES_DB;Uid=root;Pwd=123456;CharSet=utf8mb4;SslMode=none;"
       providerName="MySql.Data.MySqlClient" />
</connectionStrings>
```

## 📋 代码规范要点

### 命名规范
- **类名**：PascalCase（如：MaterialBLL）
- **方法名**：PascalCase（如：GetById）
- **变量名**：camelCase（如：materialBLL）
- **常量**：UPPER_CASE（如：MAX_RETRY_COUNT）

### 异常处理模式
```csharp
try
{
    // 业务逻辑
    return _dal.Add(entity);
}
catch (Exception ex)
{
    LogManager.Error("操作失败", ex);
    throw; // 重新抛出，让上层处理
}
```

### 日志记录规范
```csharp
LogManager.Info("操作成功信息");
LogManager.Warning("警告信息");
LogManager.Error("错误信息", exception);
```

## ⚠️ 重要注意事项

1. **MySQL API统一** - 所有DAL层已统一使用MySqlParameter
2. **BaseModel继承** - 所有模型类继承BaseModel，包含通用属性
3. **异常处理** - 统一使用MESException和LogManager
4. **编码规范** - 严格遵循Microsoft C#编码规范

## 🎯 开发时间目标

- **今日（6月6日）**：H/S成员完成BLL层，L成员完成UI集成
- **明日（6月7日）**：H/S成员开始UI开发，L成员完善功能
- **6月8日**：各模块基本功能完成
- **6月9-12日**：系统集成和测试

---

**架构已完全就绪，团队全速开发！** 🚀
