# MESå›¢é˜Ÿå¼€å‘å®Œæ•´æŒ‡å—

> **æ›´æ–°æ—¶é—´ï¼š2025-06-06 08:52**
> **çŠ¶æ€ï¼šâœ… æ¶æ„å®Œå…¨å°±ç»ªï¼Œå›¢é˜Ÿå¯å…¨é€Ÿå¼€å‘**

## ğŸ¯ å½“å‰é¡¹ç›®çŠ¶æ€æ€»è§ˆ

### âœ… å·²å®Œæˆçš„æ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼ˆ100%ï¼‰
- **MES.Common** - æ—¥å¿—ã€å¼‚å¸¸ã€é…ç½®ç®¡ç† âœ…
- **MES.Models** - åŸºç¡€æ¨¡å‹ã€ç‰©æ–™æ¨¡å‹ã€ç”Ÿäº§æ¨¡å‹ã€è½¦é—´æ¨¡å‹ âœ…
- **MES.DAL** - MySQLæ¶æ„ç»Ÿä¸€ï¼Œä¼ä¸šçº§æ•°æ®è®¿é—®å±‚ âœ…
- **MES.BLL** - Læˆå‘˜ç‰©æ–™ç®¡ç†ä¸šåŠ¡é€»è¾‘ âœ…

### ğŸš§ è¿›è¡Œä¸­çš„å¼€å‘ä»»åŠ¡
- **Læˆå‘˜** - ç‰©æ–™ç®¡ç†UIå¼€å‘ï¼ˆMaterialManagementFormå·²åˆ›å»ºï¼‰
- **Hæˆå‘˜** - ç”Ÿäº§ç®¡ç†BLLå±‚å¼€å‘ï¼ˆæ¨¡å‹ç±»å·²å°±ç»ªï¼‰
- **Sæˆå‘˜** - è½¦é—´ç®¡ç†BLLå±‚å¼€å‘ï¼ˆæ¨¡å‹ç±»å·²å°±ç»ªï¼‰

## ğŸ‘¥ å›¢é˜Ÿæˆå‘˜è¯¦ç»†ä»»åŠ¡åˆ†é…

### ğŸ”¥ Læˆå‘˜ï¼ˆç‰©æ–™ç®¡ç†ï¼‰- UIå¼€å‘é˜¶æ®µ

#### å½“å‰çŠ¶æ€
- âœ… MaterialBLL.cs, BOMBLL.cs å·²å®Œæˆ
- âœ… MaterialManagementForm.cs å·²åˆ›å»ºæ¡†æ¶
- ğŸš§ éœ€è¦é›†æˆBLLå±‚ï¼Œå®ç°å®Œæ•´UIåŠŸèƒ½

#### ç«‹å³ä»»åŠ¡æ¸…å•
```csharp
// 1. å®Œå–„MaterialManagementForm.cs
ä½ç½®ï¼šsrc/MES.UI/Forms/Material/MaterialManagementForm.cs

éœ€è¦å®ç°ï¼š
- ç‰©æ–™åˆ—è¡¨æ˜¾ç¤ºï¼ˆDataGridViewï¼‰
- æœç´¢å’Œç­›é€‰åŠŸèƒ½
- æ·»åŠ /ç¼–è¾‘/åˆ é™¤æ“ä½œ
- BLLå±‚é›†æˆè°ƒç”¨

// 2. é›†æˆBLLå±‚ç¤ºä¾‹ä»£ç 
using MES.BLL.Material;
using MES.Models.Material;

private MaterialBLL materialBLL = new MaterialBLL();

// åŠ è½½ç‰©æ–™åˆ—è¡¨
private void LoadMaterialList()
{
    try
    {
        var materials = materialBLL.GetAll();
        dataGridView1.DataSource = materials;
    }
    catch (Exception ex)
    {
        MessageBox.Show($"åŠ è½½ç‰©æ–™åˆ—è¡¨å¤±è´¥ï¼š{ex.Message}");
    }
}
```

#### å¼€å‘å‚è€ƒ
- **BLLè°ƒç”¨ç¤ºä¾‹**ï¼šå‚è€ƒå·²å®Œæˆçš„MaterialBLL.csæ–¹æ³•
- **UIè®¾è®¡æ¨¡å¼**ï¼šå‚è€ƒMainForm.csçš„æ··åˆæ¶æ„
- **å¼‚å¸¸å¤„ç†**ï¼šç»Ÿä¸€ä½¿ç”¨try-catch + MessageBoxæ˜¾ç¤º

### âš¡ Hæˆå‘˜ï¼ˆç”Ÿäº§ç®¡ç†ï¼‰- BLLå±‚å¼€å‘

#### å½“å‰çŠ¶æ€
- âœ… ProductionOrderInfo.cs æ¨¡å‹å·²åˆ›å»º
- âœ… ProductionOrderDAL.cs å·²ä¿®å¤MySQL API
- ğŸš§ éœ€è¦åˆ›å»ºBLLå±‚æ¥å£å’Œå®ç°

#### ç«‹å³ä»»åŠ¡æ¸…å•
```csharp
// 1. åˆ›å»ºæ¥å£æ–‡ä»¶
ä½ç½®ï¼šsrc/MES.BLL/Production/IProductionOrderBLL.cs

using System;
using System.Collections.Generic;
using MES.Models.Production;

namespace MES.BLL.Production
{
    public interface IProductionOrderBLL
    {
        bool Add(ProductionOrderInfo entity);
        bool Update(ProductionOrderInfo entity);
        bool Delete(int id);
        ProductionOrderInfo GetById(int id);
        List<ProductionOrderInfo> GetAll();
        ProductionOrderInfo GetByOrderNo(string orderNo);
        List<ProductionOrderInfo> GetByStatus(string status);
        bool UpdateStatus(int id, string status);
        List<ProductionOrderInfo> GetByDateRange(DateTime startDate, DateTime endDate);
    }
}

// 2. åˆ›å»ºå®ç°æ–‡ä»¶
ä½ç½®ï¼šsrc/MES.BLL/Production/ProductionOrderBLL.cs

using System;
using System.Collections.Generic;
using MES.Models.Production;
using MES.DAL.Production;
using MES.Common.Logging;
using MES.Common.Exceptions;

namespace MES.BLL.Production
{
    public class ProductionOrderBLL : IProductionOrderBLL
    {
        private readonly ProductionOrderDAL _productionOrderDAL;

        public ProductionOrderBLL()
        {
            _productionOrderDAL = new ProductionOrderDAL();
        }

        public bool Add(ProductionOrderInfo entity)
        {
            try
            {
                // ä¸šåŠ¡éªŒè¯
                if (string.IsNullOrEmpty(entity.OrderNo))
                {
                    throw new MESException("è®¢å•ç¼–å·ä¸èƒ½ä¸ºç©º");
                }

                // æ£€æŸ¥è®¢å•ç¼–å·æ˜¯å¦é‡å¤
                var existing = _productionOrderDAL.GetByOrderNo(entity.OrderNo);
                if (existing != null)
                {
                    throw new MESException("è®¢å•ç¼–å·å·²å­˜åœ¨");
                }

                return _productionOrderDAL.Add(entity);
            }
            catch (Exception ex)
            {
                LogManager.Error("æ·»åŠ ç”Ÿäº§è®¢å•å¤±è´¥", ex);
                throw;
            }
        }

        // å…¶ä»–æ–¹æ³•å®ç°...
    }
}
```

#### ä¸šåŠ¡é€»è¾‘è¦ç‚¹
- **è®¢å•ç¼–å·å”¯ä¸€æ€§éªŒè¯**
- **çŠ¶æ€æµè½¬æ§åˆ¶**ï¼ˆå¾…å¼€å§‹â†’è¿›è¡Œä¸­â†’å·²å®Œæˆï¼‰
- **æ•°é‡éªŒè¯**ï¼ˆå®Œæˆæ•°é‡ä¸èƒ½è¶…è¿‡è®¡åˆ’æ•°é‡ï¼‰
- **æ—¶é—´é€»è¾‘éªŒè¯**ï¼ˆå¼€å§‹æ—¶é—´ä¸èƒ½æ™šäºç»“æŸæ—¶é—´ï¼‰

### ğŸš€ Sæˆå‘˜ï¼ˆè½¦é—´ç®¡ç†ï¼‰- BLLå±‚å¼€å‘

#### å½“å‰çŠ¶æ€
- âœ… WorkshopInfo.cs æ¨¡å‹å·²åˆ›å»º
- âœ… WorkshopDAL.cs å·²ä¿®å¤MySQL API
- ğŸš§ éœ€è¦åˆ›å»ºBLLå±‚æ¥å£å’Œå®ç°

#### ç«‹å³ä»»åŠ¡æ¸…å•
```csharp
// 1. åˆ›å»ºæ¥å£æ–‡ä»¶
ä½ç½®ï¼šsrc/MES.BLL/Workshop/IWorkshopBLL.cs

using System;
using System.Collections.Generic;
using MES.Models.Workshop;

namespace MES.BLL.Workshop
{
    public interface IWorkshopBLL
    {
        bool Add(WorkshopInfo entity);
        bool Update(WorkshopInfo entity);
        bool Delete(int id);
        WorkshopInfo GetById(int id);
        List<WorkshopInfo> GetAll();
        WorkshopInfo GetByWorkshopCode(string workshopCode);
        List<WorkshopInfo> GetByStatus(string status);
        bool UpdateWorkshopStatus(int id, string status);
        List<WorkshopInfo> GetByDepartment(string department);
    }
}

// 2. åˆ›å»ºå®ç°æ–‡ä»¶
ä½ç½®ï¼šsrc/MES.BLL/Workshop/WorkshopBLL.cs

using System;
using System.Collections.Generic;
using MES.Models.Workshop;
using MES.DAL.Workshop;
using MES.Common.Logging;
using MES.Common.Exceptions;

namespace MES.BLL.Workshop
{
    public class WorkshopBLL : IWorkshopBLL
    {
        private readonly WorkshopDAL _workshopDAL;

        public WorkshopBLL()
        {
            _workshopDAL = new WorkshopDAL();
        }

        public bool Add(WorkshopInfo entity)
        {
            try
            {
                // ä¸šåŠ¡éªŒè¯
                if (string.IsNullOrEmpty(entity.WorkshopCode))
                {
                    throw new MESException("è½¦é—´ç¼–ç ä¸èƒ½ä¸ºç©º");
                }

                // æ£€æŸ¥è½¦é—´ç¼–ç æ˜¯å¦é‡å¤
                var existing = _workshopDAL.GetByWorkshopCode(entity.WorkshopCode);
                if (existing != null)
                {
                    throw new MESException("è½¦é—´ç¼–ç å·²å­˜åœ¨");
                }

                return _workshopDAL.Add(entity);
            }
            catch (Exception ex)
            {
                LogManager.Error("æ·»åŠ è½¦é—´ä¿¡æ¯å¤±è´¥", ex);
                throw;
            }
        }

        // å…¶ä»–æ–¹æ³•å®ç°...
    }
}
```

#### ä¸šåŠ¡é€»è¾‘è¦ç‚¹
- **è½¦é—´ç¼–ç å”¯ä¸€æ€§éªŒè¯**
- **äº§èƒ½åˆç†æ€§æ£€æŸ¥**ï¼ˆè®¾å¤‡æ•°é‡ä¸äº§èƒ½çš„å…³ç³»ï¼‰
- **çŠ¶æ€å˜æ›´æ§åˆ¶**ï¼ˆæ­£å¸¸è¿è¡Œâ†”ç»´æŠ¤ä¸­â†”æ•…éšœåœæœºï¼‰
- **å®‰å…¨ç­‰çº§éªŒè¯**

## ğŸ”§ å¼€å‘ç¯å¢ƒé…ç½®

### Gitå·¥ä½œæµç¨‹
```bash
# 1. æ›´æ–°æœ¬åœ°developåˆ†æ”¯
git checkout develop
git pull origin develop

# 2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feature/æˆå‘˜-æ¨¡å—åç§°

# 3. æ¯æ—¥æäº¤
git add .
git commit -m "æˆå‘˜æ ‡è¯†: æ¨¡å— - åŠŸèƒ½æè¿°"
git push origin feature/æˆå‘˜-æ¨¡å—åç§°

# 4. å®Œæˆååˆ›å»ºPR
# åœ¨GitHubä¸Šåˆ›å»ºPull Requeståˆ°developåˆ†æ”¯
```

### ç¼–è¯‘éªŒè¯
```bash
# éªŒè¯å„å±‚ç¼–è¯‘
dotnet build src/MES.Models/MES.Models.csproj  # âœ… é€šè¿‡
dotnet build src/MES.DAL/MES.DAL.csproj        # âœ… é€šè¿‡
dotnet build src/MES.BLL/MES.BLL.csproj        # âœ… é€šè¿‡
```

### æ•°æ®åº“è¿æ¥é…ç½®
```xml
<!-- App.config ç¤ºä¾‹ -->
<connectionStrings>
  <add name="MESConnectionString"
       connectionString="Server=localhost;Database=MES_DB;Uid=root;Pwd=123456;CharSet=utf8mb4;SslMode=none;"
       providerName="MySql.Data.MySqlClient" />
</connectionStrings>
```

## ğŸ“‹ ä»£ç è§„èŒƒè¦ç‚¹

### å‘½åè§„èŒƒ
- **ç±»å**ï¼šPascalCaseï¼ˆå¦‚ï¼šMaterialBLLï¼‰
- **æ–¹æ³•å**ï¼šPascalCaseï¼ˆå¦‚ï¼šGetByIdï¼‰
- **å˜é‡å**ï¼šcamelCaseï¼ˆå¦‚ï¼šmaterialBLLï¼‰
- **å¸¸é‡**ï¼šUPPER_CASEï¼ˆå¦‚ï¼šMAX_RETRY_COUNTï¼‰

### å¼‚å¸¸å¤„ç†æ¨¡å¼
```csharp
try
{
    // ä¸šåŠ¡é€»è¾‘
    return _dal.Add(entity);
}
catch (Exception ex)
{
    LogManager.Error("æ“ä½œå¤±è´¥", ex);
    throw; // é‡æ–°æŠ›å‡ºï¼Œè®©ä¸Šå±‚å¤„ç†
}
```

### æ—¥å¿—è®°å½•è§„èŒƒ
```csharp
LogManager.Info("æ“ä½œæˆåŠŸä¿¡æ¯");
LogManager.Warning("è­¦å‘Šä¿¡æ¯");
LogManager.Error("é”™è¯¯ä¿¡æ¯", exception);
```

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

1. **MySQL APIç»Ÿä¸€** - æ‰€æœ‰DALå±‚å·²ç»Ÿä¸€ä½¿ç”¨MySqlParameter
2. **BaseModelç»§æ‰¿** - æ‰€æœ‰æ¨¡å‹ç±»ç»§æ‰¿BaseModelï¼ŒåŒ…å«é€šç”¨å±æ€§
3. **å¼‚å¸¸å¤„ç†** - ç»Ÿä¸€ä½¿ç”¨MESExceptionå’ŒLogManager
4. **ç¼–ç è§„èŒƒ** - ä¸¥æ ¼éµå¾ªMicrosoft C#ç¼–ç è§„èŒƒ

## ğŸ¯ å¼€å‘æ—¶é—´ç›®æ ‡

- **ä»Šæ—¥ï¼ˆ6æœˆ6æ—¥ï¼‰**ï¼šH/Sæˆå‘˜å®ŒæˆBLLå±‚ï¼ŒLæˆå‘˜å®ŒæˆUIé›†æˆ
- **æ˜æ—¥ï¼ˆ6æœˆ7æ—¥ï¼‰**ï¼šH/Sæˆå‘˜å¼€å§‹UIå¼€å‘ï¼ŒLæˆå‘˜å®Œå–„åŠŸèƒ½
- **6æœˆ8æ—¥**ï¼šå„æ¨¡å—åŸºæœ¬åŠŸèƒ½å®Œæˆ
- **6æœˆ9-12æ—¥**ï¼šç³»ç»Ÿé›†æˆå’Œæµ‹è¯•

---

**æ¶æ„å·²å®Œå…¨å°±ç»ªï¼Œå›¢é˜Ÿå…¨é€Ÿå¼€å‘ï¼** ğŸš€
