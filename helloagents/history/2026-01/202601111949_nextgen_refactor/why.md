# 变更提案: 次世代洞察与未来感UI重构

## 需求背景
当前系统具备完整的基础业务能力，但运营层面缺少“可落地的预警与洞察”，UI 也偏向传统风格，难以承载高频监控场景。此次升级希望在不破坏核心逻辑与分层架构的前提下，引入高价值业务洞察能力，并对 UI 进行现代化重塑，提升可用性与决策效率。

## 产品分析

### 目标用户与场景
- **用户群体:** 产线主管、计划员、品质工程师、设备维护工程师
- **使用场景:** 日常运营看板、订单交付预警、设备维保排程、质量异常排查
- **核心痛点:** 预警滞后、跨模块数据碎片化、界面信息密度不足

### 价值主张与成功指标
- **价值主张:** 用可解释的指标聚合多模块信息，形成“可执行的风险提示”。
- **成功指标:** 交付延期率下降、异常响应时间缩短、关键指标一屏可视化

### 人文关怀
保障操作负担可控，避免过度告警；对异常风险使用清晰分级提示，减少焦虑与误判。

## 变更内容
1. 新增运营洞察能力（生产风险、在制品老化、设备健康、物料安全库存、质量缺陷、批次良率）。
2. 建立可扩展的洞察聚合服务，UI 通过统一接口获取指标。
3. 引入未来感主题与高一致性视觉 Token，重塑主界面体验。
4. 进行性能与可维护性清理（缓存、去重、减轻 UI 线程压力）。
5. 重写双语 README，统一项目入口说明与设计理念。

## 影响范围
- **模块:** MES.UI、MES.UI.Framework、MES.BLL、MES.DAL、MES.Models
- **文件:** 新增洞察模型/服务/窗体、主题系统调整、README 更新
- **API:** 新增内部 BLL 洞察接口
- **数据:** 不新增数据库表，基于现有数据聚合计算

## 核心场景

### 需求: 生产订单风险预警
**模块:** MES.BLL.Production / MES.DAL.Production
通过计划完成时间、状态与优先级计算风险等级，输出即将延期与已延期订单清单。

#### 场景: 交付风险提示
当订单距离计划完成时间不足 24 小时且未完成，系统标记为“高风险”，并在洞察面板置顶。
- 预期结果: 生产负责人可提前干预。

### 需求: 在制品老化与瓶颈识别
**模块:** MES.BLL.Workshop / MES.DAL.Workshop
对在制品进行时长统计，识别老化超过阈值的批次与拥塞工位。

#### 场景: 老化聚合与瓶颈定位
当某工位 WIP 数量显著高于平均水平时，系统提示潜在瓶颈。
- 预期结果: 运维/计划人员可快速定位拥塞环节。

### 需求: 设备健康与维保预测
**模块:** MES.BLL.Workshop / MES.DAL.Workshop
基于设备保养周期与状态记录，生成健康评分与维保优先级。

#### 场景: 维保到期预警
当设备已超过建议保养天数时，系统列入“需维护”清单。
- 预期结果: 设备维护更具前瞻性。

### 需求: 物料安全库存预警
**模块:** MES.BLL.Material / MES.DAL.Material
根据安全库存、最小库存与当前库存量生成风险等级。

#### 场景: 低库存告警
当库存低于安全库存阈值，系统提示“补货优先级”。
- 预期结果: 降低因缺料导致的停线风险。

### 需求: 质量缺陷热点与良率趋势
**模块:** MES.BLL.Quality / MES.DAL.Quality
统计质量检验结果、缺陷原因排名、阶段分布与良率趋势。

#### 场景: 缺陷原因聚焦
当某缺陷原因占比超过阈值时，系统提示排查优先级。
- 预期结果: 品质问题快速定位与闭环。

### 需求: 批次良率偏差分析
**模块:** MES.BLL.Workshop / MES.DAL.Workshop
对批次计划与实际产出差异进行分析，识别低良率批次。

#### 场景: 低良率批次提示
当实际产出低于计划阈值时，系统提示原因追踪建议。
- 预期结果: 生产效率与质量提升。

### 需求: 未来感主界面与洞察入口
**模块:** MES.UI / MES.UI.Framework
重塑主界面布局与视觉层级，新增洞察入口与状态卡片。

#### 场景: 一屏获取关键风险
用户进入系统即可看到风险概览与重点提醒。
- 预期结果: 降低操作路径与认知负担。

## 风险评估
- **风险:** 统计逻辑可能与历史口径不一致。
  **缓解:** 指标计算统一在 BLL 层，保留可配置阈值。
- **风险:** UI 大改可能影响习惯用户。
  **缓解:** 维持原模块入口结构，视觉升级不改变核心流程。
- **风险:** 聚合查询性能波动。
  **缓解:** 引入轻量缓存与分段查询。
