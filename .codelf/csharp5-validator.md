# C# 5.0语法验证工具

> **目的**: 为AI提供实际可执行的C# 5.0语法检查机制
> **创建时间**: 2025-06-09 12:35:00
> **使用场景**: AI在生成任何C#代码前必须使用此工具进行验证

## 🔍 **违规语法检测规则**

### **规则1：空传播运算符检测**
```
违规模式: ?.
检测方法: 搜索代码中的 "?."
替换规则: 
  obj?.Method() → obj != null ? obj.Method() : [默认值]
  obj?.Property → obj != null ? obj.Property : [默认值]
```

### **规则2：字符串插值检测**
```
违规模式: $"
检测方法: 搜索代码中的 "$\""
替换规则:
  $"Hello {name}" → string.Format("Hello {0}", name)
  $"Count: {items.Count}" → string.Format("Count: {0}", items.Count)
```

### **规则3：nameof运算符检测**
```
违规模式: nameof(
检测方法: 搜索代码中的 "nameof("
替换规则:
  nameof(variable) → "variable"
  nameof(Property) → "Property"
```

### **规则4：其他C# 6.0+特性检测**
```
违规模式: 
- using static
- 表达式体成员 =>
- 自动属性初始化器 { get; set; } = value;
- 异常筛选器 when
- await in catch/finally
```

## 🛠 **AI使用协议**

### **强制执行步骤**
```
第1步：【代码准备】
- AI构思完整的代码逻辑

第2步：【逐行扫描】
- 将代码分解为单行
- 逐行应用检测规则
- 标记所有违规项

第3步：【强制替换】
- 将所有违规语法替换为C# 5.0兼容版本
- 不允许跳过任何违规项

第4步：【验证声明】
- AI必须明确声明："已通过C# 5.0语法验证"
- 列出检查的行数和替换的项数

第5步：【代码输出】
- 输出最终的C# 5.0兼容代码
```

## 📋 **验证检查清单**

### **每次代码生成前必须完成**
- [ ] 已扫描所有代码行
- [ ] 已检查空传播运算符 (?.)
- [ ] 已检查字符串插值 ($"")
- [ ] 已检查nameof运算符
- [ ] 已检查其他C# 6.0+特性
- [ ] 已替换所有违规语法
- [ ] 已验证替换后的语法正确性

### **验证失败处理**
```
如果发现违规语法：
1. 立即停止代码输出
2. 报告违规项的具体位置
3. 提供正确的C# 5.0替换方案
4. 重新执行验证流程
```

## 🔧 **实际使用示例**

### **示例1：违规代码检测**
```csharp
// 原始代码（违规）
var result = obj?.Method()?.Property;
var message = $"Error: {ex.Message}";

// 检测结果
违规项1: obj?.Method()?.Property (空传播运算符)
违规项2: $"Error: {ex.Message}" (字符串插值)

// 修复后代码（C# 5.0兼容）
var result = obj != null && obj.Method() != null ? obj.Method().Property : null;
var message = string.Format("Error: {0}", ex.Message);
```

### **示例2：验证声明格式**
```
=== C# 5.0语法验证报告 ===
扫描行数: 15行
检测到违规项: 3项
- 第3行: 空传播运算符 (已修复)
- 第7行: 字符串插值 (已修复)  
- 第12行: nameof运算符 (已修复)
验证状态: ✅ 通过
输出代码: C# 5.0兼容
```

## 🚨 **紧急中断机制**

### **当AI检测到自己可能输出违规代码时**
```
1. 立即输出: "⚠️ 检测到潜在C# 6.0+语法，正在验证..."
2. 执行完整验证流程
3. 输出验证报告
4. 提供修复后的代码
5. 请求用户确认
```

## 📊 **效果评估机制**

### **成功指标**
- 连续30天无C# 6.0+语法错误
- 每次代码生成都有验证声明
- 用户不再需要手动修复语法问题

### **失败处理**
- 如果仍然出现语法错误，说明此工具失效
- 需要升级检测规则或改进验证机制
- 向用户报告工具失效并请求改进建议

---

**使用承诺**: AI承诺在MES项目中生成任何C#代码前，都将严格使用此验证工具，并提供验证报告。如果此工具失效，AI将主动报告并请求改进。
