## MES项目开发指南和注意事项

### 框架和语言规范
> MES系统基于C# .NET Framework 4.8 + WinForms，采用企业级三层架构设计

**框架重要注意事项:**
- .NET Framework 4.8: 确保所有依赖项与4.8版本兼容，避免使用.NET Core特性
- WinForms: 采用设计器+动态代码混合模式，既支持可视化设计又保持灵活性
- 三层架构: 严格遵循UI/BLL/DAL/Models/Common分层，禁止跨层直接调用
- 项目引用: UI层只能引用BLL和Models，BLL层只能引用DAL和Models，DAL层只能引用Models和Common
- 重要框架注意事项:
	* 所有数据模型必须继承BaseModel基类
	* 统一使用LogManager进行日志记录，禁止使用Console.WriteLine
	* 异常处理统一使用MESException，包含详细的错误信息和上下文
	* 配置管理统一使用ConfigManager，支持多环境配置

**C#语言最佳实践:**
- 类型安全: 使用强类型，避免object和dynamic类型的滥用
- 现代特性: 合理使用C# 7.0+特性(如模式匹配、元组)，但保持4.8兼容性
- 一致性: 遵循Microsoft C#编码规范，使用PascalCase命名类和方法
- 文档注释: 所有公共API必须有XML文档注释，说明参数、返回值和异常

### 代码抽象和复用性
> MES系统开发中，优先考虑代码抽象和复用性，确保模块化和组件化功能。开发前先检查现有解决方案，避免重复造轮子。

**模块化设计原则:**
- 单一职责: 每个模块只负责一个功能领域(物料、生产、车间)
- 高内聚低耦合: 相关功能集中在一起，减少模块间依赖
- 稳定接口: 对外暴露稳定接口，内部实现可以变化
- 分层隔离: 严格按照三层架构分层，禁止跨层调用

**可复用组件库结构:**
```
src/
├── MES.Common/                    # 公共组件库(所有模块共享)
│   ├── Configuration/
│   │   └── ConfigManager.cs      # 配置管理: 系统配置、数据库连接字符串等
│   ├── Logging/
│   │   ├── LogManager.cs          # 日志管理: Info、Error、Debug等级别日志
│   │   └── LogLevel.cs            # 日志级别枚举
│   ├── Exceptions/
│   │   └── MESException.cs        # 统一异常处理: 业务异常、系统异常
│   └── Utilities/                 # 工具类(计划扩展)
│       ├── DateTimeHelper.cs     # 时间工具: 格式化、计算、转换
│       ├── StringHelper.cs       # 字符串工具: 验证、格式化、编码
│       └── ValidationHelper.cs   # 数据验证: 输入验证、业务规则验证
├── MES.Models/Base/
│   └── BaseModel.cs               # 基础模型: 提供ID、创建时间、更新时间等通用属性
└── MES.UI/Common/                 # UI公共组件(计划扩展)
    ├── Controls/                  # 自定义控件
    ├── Dialogs/                   # 通用对话框
    └── Helpers/                   # UI辅助类
```

### 编码标准和工具
**代码格式化工具:**
- Visual Studio: 使用内置的C#代码格式化功能，遵循Microsoft编码规范
- EditorConfig: 项目根目录配置统一的编码风格(缩进、换行等)
- StyleCop: C#代码风格检查工具，确保命名规范和代码结构一致性
- FxCop: 静态代码分析，检查潜在的性能和安全问题

**命名和结构约定:**
- 语义化命名: 变量/函数名称应清晰表达其用途，避免缩写和模糊命名
- 一致的命名风格: 类名和方法名使用PascalCase，变量名使用camelCase
- 目录结构遵循功能职责划分: 按模块(Material/Production/Workshop)组织代码
- 文件命名: 类文件名与类名保持一致，接口以I开头

### 团队协作标准
**Git工作流程和文档:**
- 分支管理策略: main(稳定) → develop(集成) → feature/成员-模块(开发)
	* 详细流程参见: docs/GIT_WORKFLOW.md
	* 快速上手指南: docs/TEAM_QUICK_START.md
- 提交消息规范: "成员标识: 模块 - 功能描述"
	* 示例: "L: 物料管理 - 完成物料信息CRUD功能"
- 代码审查要求: 所有PR必须经过天帝审查，确保代码质量和架构一致性

**数据流和接口设计:**
- 清晰的数据层管理: 严格按照三层架构，数据只能通过BLL层访问DAL层
	* UI层 → BLL层 → DAL层 → 数据库
	* 禁止UI层直接访问DAL层或数据库
- 数据验证: 前端和后端都要进行数据验证
	* UI层: 输入格式验证、必填项检查
	* BLL层: 业务规则验证、数据完整性检查
- 统一的异步操作处理: 使用async/await模式处理数据库操作和文件IO

### 性能优化和安全性
**性能优化重点:**
- 数据库操作优化
	* 使用连接池管理数据库连接，避免频繁创建和销毁连接
	* 合理使用索引，优化查询性能
	* 大数据量查询使用分页，避免一次性加载过多数据
- UI渲染性能优化
	* 大列表使用虚拟化技术(VirtualMode)，只渲染可见项
	* 合理使用DataGridView的数据绑定，避免频繁刷新
	* 图片和资源的延迟加载，减少启动时间
- 内存管理
	* 及时释放不再使用的资源，特别是数据库连接和文件句柄
	* 使用using语句确保IDisposable对象的正确释放
	* 避免内存泄漏，特别是事件订阅的取消

**安全措施:**
- 输入验证和过滤
	* 所有用户输入都要进行验证，防止SQL注入和XSS攻击
	* 使用参数化查询，避免动态SQL拼接
	* 对特殊字符进行转义和过滤
- 敏感信息保护
	* 数据库连接字符串加密存储，不在代码中硬编码
	* 用户密码使用强哈希算法(如bcrypt)加密存储
	* 日志中不记录敏感信息(密码、身份证号等)
- 访问控制机制
	* 实现基于角色的访问控制(RBAC)，不同角色有不同权限
	* 操作日志记录，追踪用户行为
	* 会话管理，防止会话劫持和固定攻击